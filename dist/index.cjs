"use strict";var Dc=Object.create;var Br=Object.defineProperty;var yo=Object.getOwnPropertyDescriptor;var qc=Object.getOwnPropertyNames;var Rc=Object.getPrototypeOf,Mc=Object.prototype.hasOwnProperty;var ee=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Bc=(r,e)=>{for(var t in e)Br(r,t,{get:e[t],enumerable:!0})},Fc=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qc(e))!Mc.call(r,i)&&i!==t&&Br(r,i,{get:()=>e[i],enumerable:!(s=yo(e,i))||s.enumerable});return r};var nr=(r,e,t)=>(t=r!=null?Dc(Rc(r)):{},Fc(e||!r||!r.__esModule?Br(t,"default",{value:r,enumerable:!0}):t,r));var te=(r,e,t,s)=>{for(var i=s>1?void 0:s?yo(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Br(e,t,i),i},Ne=(r,e)=>(t,s)=>e(t,s,r);var Fe=ee((ev,Qa)=>{"use strict";var za=["nodebuffer","arraybuffer","fragments"],Ua=typeof Blob<"u";Ua&&za.push("blob");Qa.exports={BINARY_TYPES:za,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:Ua,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var al=ee((tv,ol)=>{var Ga=require("fs"),Ve=require("path"),Ja=require("os"),Ha=typeof __webpack_require__=="function"?__non_webpack_require__:require,su=process.config&&process.config.variables||{},iu=!!process.env.PREBUILDS_ONLY,Wa=process.versions.modules,Ln=au()?"electron":ou()?"node-webkit":"node",jn=process.env.npm_config_arch||Ja.arch(),Dn=process.env.npm_config_platform||Ja.platform(),Xa=process.env.LIBC||(lu(Dn)?"musl":"glibc"),qn=process.env.ARM_VERSION||(jn==="arm64"?"8":su.arm_version)||"",Ya=(process.versions.uv||"").split(".")[0];ol.exports=Ie;function Ie(r){return Ha(Ie.resolve(r))}Ie.resolve=Ie.path=function(r){r=Ve.resolve(r||".");try{var e=Ha(Ve.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!iu){var t=Ka(Ve.join(r,"build/Release"),Za);if(t)return t;var s=Ka(Ve.join(r,"build/Debug"),Za);if(s)return s}var i=a(r);if(i)return i;var n=a(Ve.dirname(process.execPath));if(n)return n;var o=["platform="+Dn,"arch="+jn,"runtime="+Ln,"abi="+Wa,"uv="+Ya,qn?"armv="+qn:"","libc="+Xa,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+o+`
    loaded from: `+r+`
`);function a(u){var l=Rn(Ve.join(u,"prebuilds")).map(el),c=l.filter(tl(Dn,jn)).sort(rl)[0];if(c){var h=Ve.join(u,"prebuilds",c.name),g=Rn(h).map(sl),N=g.filter(il(Ln,Wa)),k=N.sort(nl(Ln))[0];if(k)return Ve.join(h,k.file)}}};function Rn(r){try{return Ga.readdirSync(r)}catch{return[]}}function Ka(r,e){var t=Rn(r).filter(e);return t[0]&&Ve.join(r,t[0])}function Za(r){return/\.node$/.test(r)}function el(r){var e=r.split("-");if(e.length===2){var t=e[0],s=e[1].split("+");if(t&&s.length&&s.every(Boolean))return{name:r,platform:t,architectures:s}}}function tl(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function rl(r,e){return r.architectures.length-e.architectures.length}function sl(r){var e=r.split("."),t=e.pop(),s={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var n=e[i];if(n==="node"||n==="electron"||n==="node-webkit")s.runtime=n;else if(n==="napi")s.napi=!0;else if(n.slice(0,3)==="abi")s.abi=n.slice(3);else if(n.slice(0,2)==="uv")s.uv=n.slice(2);else if(n.slice(0,4)==="armv")s.armv=n.slice(4);else if(n==="glibc"||n==="musl")s.libc=n;else continue;s.specificity++}return s}}function il(r,e){return function(t){return!(t==null||t.runtime&&t.runtime!==r&&!nu(t)||t.abi&&t.abi!==e&&!t.napi||t.uv&&t.uv!==Ya||t.armv&&t.armv!==qn||t.libc&&t.libc!==Xa)}}function nu(r){return r.runtime==="node"&&r.napi}function nl(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function ou(){return!!(process.versions&&process.versions.nw)}function au(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function lu(r){return r==="linux"&&Ga.existsSync("/etc/alpine-release")}Ie.parseTags=sl;Ie.matchTags=il;Ie.compareTags=nl;Ie.parseTuple=el;Ie.matchTuple=tl;Ie.compareTuples=rl});var ll=ee((rv,Bn)=>{var Mn=typeof __webpack_require__=="function"?__non_webpack_require__:require;typeof Mn.addon=="function"?Bn.exports=Mn.addon.bind(Mn):Bn.exports=al()});var ul=ee((sv,cl)=>{"use strict";var cu=(r,e,t,s,i)=>{for(var n=0;n<i;n++)t[s+n]=r[n]^e[n&3]},uu=(r,e)=>{let t=r.length;for(var s=0;s<t;s++)r[s]^=e[s&3]};cl.exports={mask:cu,unmask:uu}});var fl=ee((iv,Fn)=>{"use strict";try{Fn.exports=ll()(__dirname)}catch{Fn.exports=ul()}});var Er=ee((nv,_s)=>{"use strict";var{EMPTY_BUFFER:fu}=Fe(),Vn=Buffer[Symbol.species];function du(r,e){if(r.length===0)return fu;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e),s=0;for(let i=0;i<r.length;i++){let n=r[i];t.set(n,s),s+=n.length}return s<e?new Vn(t.buffer,t.byteOffset,s):t}function dl(r,e,t,s,i){for(let n=0;n<i;n++)t[s+n]=r[n]^e[n&3]}function hl(r,e){for(let t=0;t<r.length;t++)r[t]^=e[t&3]}function hu(r){return r.length===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.length)}function zn(r){if(zn.readOnly=!0,Buffer.isBuffer(r))return r;let e;return r instanceof ArrayBuffer?e=new Vn(r):ArrayBuffer.isView(r)?e=new Vn(r.buffer,r.byteOffset,r.byteLength):(e=Buffer.from(r),zn.readOnly=!1),e}_s.exports={concat:du,mask:dl,toArrayBuffer:hu,toBuffer:zn,unmask:hl};if(!process.env.WS_NO_BUFFER_UTIL)try{let r=fl();_s.exports.mask=function(e,t,s,i,n){n<48?dl(e,t,s,i,n):r.mask(e,t,s,i,n)},_s.exports.unmask=function(e,t){e.length<32?hl(e,t):r.unmask(e,t)}}catch{}});var gl=ee((ov,pl)=>{"use strict";var ml=Symbol("kDone"),Un=Symbol("kRun"),Qn=class{constructor(e){this[ml]=()=>{this.pending--,this[Un]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Un]()}[Un](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[ml])}}};pl.exports=Qn});var Pr=ee((av,vl)=>{"use strict";var kr=require("zlib"),yl=Er(),mu=gl(),{kStatusCode:_l}=Fe(),pu=Buffer[Symbol.species],gu=Buffer.from([0,0,255,255]),vs=Symbol("permessage-deflate"),ze=Symbol("total-length"),Bt=Symbol("callback"),Ye=Symbol("buffers"),Ft=Symbol("error"),bs,Wn=class{constructor(e,t,s){if(this._maxPayload=s|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!bs){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;bs=new mu(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Bt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,s=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(s.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?s.client_max_window_bits=t.clientMaxWindowBits:(s.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(s=>{let i=t[s];if(i.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(i=i[0],s==="client_max_window_bits"){if(i!==!0){let n=+i;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${s}": ${i}`);i=n}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${i}`)}else if(s==="server_max_window_bits"){let n=+i;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${s}": ${i}`);i=n}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${i}`)}else throw new Error(`Unknown parameter "${s}"`);t[s]=i})}),e}decompress(e,t,s){bs.add(i=>{this._decompress(e,t,(n,o)=>{i(),s(n,o)})})}compress(e,t,s){bs.add(i=>{this._compress(e,t,(n,o)=>{i(),s(n,o)})})}_decompress(e,t,s){let i=this._isServer?"client":"server";if(!this._inflate){let n=`${i}_max_window_bits`,o=typeof this.params[n]!="number"?kr.Z_DEFAULT_WINDOWBITS:this.params[n];this._inflate=kr.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[vs]=this,this._inflate[ze]=0,this._inflate[Ye]=[],this._inflate.on("error",_u),this._inflate.on("data",bl)}this._inflate[Bt]=s,this._inflate.write(e),t&&this._inflate.write(gu),this._inflate.flush(()=>{let n=this._inflate[Ft];if(n){this._inflate.close(),this._inflate=null,s(n);return}let o=yl.concat(this._inflate[Ye],this._inflate[ze]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[ze]=0,this._inflate[Ye]=[],t&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(e,t,s){let i=this._isServer?"server":"client";if(!this._deflate){let n=`${i}_max_window_bits`,o=typeof this.params[n]!="number"?kr.Z_DEFAULT_WINDOWBITS:this.params[n];this._deflate=kr.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[ze]=0,this._deflate[Ye]=[],this._deflate.on("data",yu)}this._deflate[Bt]=s,this._deflate.write(e),this._deflate.flush(kr.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let n=yl.concat(this._deflate[Ye],this._deflate[ze]);t&&(n=new pu(n.buffer,n.byteOffset,n.length-4)),this._deflate[Bt]=null,this._deflate[ze]=0,this._deflate[Ye]=[],t&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),s(null,n)})}};vl.exports=Wn;function yu(r){this[Ye].push(r),this[ze]+=r.length}function bl(r){if(this[ze]+=r.length,this[vs]._maxPayload<1||this[ze]<=this[vs]._maxPayload){this[Ye].push(r);return}this[Ft]=new RangeError("Max payload size exceeded"),this[Ft].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ft][_l]=1009,this.removeListener("data",bl),this.reset()}function _u(r){if(this[vs]._inflate=null,this[Ft]){this[Bt](this[Ft]);return}r[_l]=1007,this[Bt](r)}});var Vt=ee((lv,ws)=>{"use strict";var{isUtf8:wl}=require("buffer"),{hasBlob:bu}=Fe(),vu=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function wu(r){return r>=1e3&&r<=1014&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999}function Kn(r){let e=r.length,t=0;for(;t<e;)if((r[t]&128)===0)t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}function xu(r){return bu&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&(r[Symbol.toStringTag]==="Blob"||r[Symbol.toStringTag]==="File")}ws.exports={isBlob:xu,isValidStatusCode:wu,isValidUTF8:Kn,tokenChars:vu};if(wl)ws.exports.isValidUTF8=function(r){return r.length<24?Kn(r):wl(r)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let r=require("utf-8-validate");ws.exports.isValidUTF8=function(e){return e.length<32?Kn(e):r(e)}}catch{}});var Xn=ee((cv,kl)=>{"use strict";var{Writable:Su}=require("stream"),xl=Pr(),{BINARY_TYPES:Tu,EMPTY_BUFFER:Sl,kStatusCode:Nu,kWebSocket:Cu}=Fe(),{concat:Zn,toArrayBuffer:Eu,unmask:ku}=Er(),{isValidStatusCode:Pu,isValidUTF8:Tl}=Vt(),xs=Buffer[Symbol.species],we=0,Nl=1,Cl=2,El=3,Gn=4,Jn=5,Ss=6,Hn=class extends Su{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Tu[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Cu]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=we}_write(e,t,s){if(this._opcode===8&&this._state==we)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new xs(s.buffer,s.byteOffset+e,s.length-e),new xs(s.buffer,s.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let s=this._buffers[0],i=t.length-e;e>=s.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),i),this._buffers[0]=new xs(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case we:this.getInfo(e);break;case Nl:this.getPayloadLength16(e);break;case Cl:this.getPayloadLength64(e);break;case El:this.getMask();break;case Gn:this.getData(e);break;case Jn:case Ss:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let s=(t[0]&64)===64;if(s&&!this._extensions[xl.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(s){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=s}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(s){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=Nl:this._payloadLength===127?this._state=Cl:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),s=t.readUInt32BE(0);if(s>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=El:this._state=Gn}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Gn}getData(e){let t=Sl;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&ku(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Jn,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[xl.extensionName].decompress(e,this._fin,(i,n)=>{if(i)return t(i);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(o);return}this._fragments.push(n)}this.dataMessage(t),this._state===we&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=we;return}let t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=Zn(s,t):this._binaryType==="arraybuffer"?i=Eu(Zn(s,t)):this._binaryType==="blob"?i=new Blob(s):i=s,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=we):(this._state=Ss,setImmediate(()=>{this.emit("message",i,!0),this._state=we,this.startLoop(e)}))}else{let i=Zn(s,t);if(!this._skipUTF8Validation&&!Tl(i)){let n=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(n);return}this._state===Jn||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=we):(this._state=Ss,setImmediate(()=>{this.emit("message",i,!1),this._state=we,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Sl),this.end();else{let s=e.readUInt16BE(0);if(!Pu(s)){let n=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(n);return}let i=new xs(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Tl(i)){let n=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(n);return}this._loop=!1,this.emit("conclude",s,i),this.end()}this._state=we;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=we):(this._state=Ss,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=we,this.startLoop(t)}))}createError(e,t,s,i,n){this._loop=!1,this._errored=!0;let o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=n,o[Nu]=i,o}};kl.exports=Hn});var to=ee((fv,Al)=>{"use strict";var{Duplex:uv}=require("stream"),{randomFillSync:Ou}=require("crypto"),Pl=Pr(),{EMPTY_BUFFER:Au,kWebSocket:$u,NOOP:Iu}=Fe(),{isBlob:zt,isValidStatusCode:Lu}=Vt(),{mask:Ol,toBuffer:lt}=Er(),xe=Symbol("kByteLength"),ju=Buffer.alloc(4),Ts=8*1024,ct,Ut=Ts,ke=0,Du=1,qu=2,Yn=class r{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=ke,this.onerror=Iu,this[$u]=void 0}static frame(e,t){let s,i=!1,n=2,o=!1;t.mask&&(s=t.maskBuffer||ju,t.generateMask?t.generateMask(s):(Ut===Ts&&(ct===void 0&&(ct=Buffer.alloc(Ts)),Ou(ct,0,Ts),Ut=0),s[0]=ct[Ut++],s[1]=ct[Ut++],s[2]=ct[Ut++],s[3]=ct[Ut++]),o=(s[0]|s[1]|s[2]|s[3])===0,n=6);let a;typeof e=="string"?(!t.mask||o)&&t[xe]!==void 0?a=t[xe]:(e=Buffer.from(e),a=e.length):(a=e.length,i=t.mask&&t.readOnly&&!o);let u=a;a>=65536?(n+=8,u=127):a>125&&(n+=2,u=126);let l=Buffer.allocUnsafe(i?a+n:n);return l[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(l[0]|=64),l[1]=u,u===126?l.writeUInt16BE(a,2):u===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),t.mask?(l[1]|=128,l[n-4]=s[0],l[n-3]=s[1],l[n-2]=s[2],l[n-1]=s[3],o?[l,e]:i?(Ol(e,s,l,n,a),[l]):(Ol(e,s,e,0,a),[l,e])):[l,e]}close(e,t,s,i){let n;if(e===void 0)n=Au;else{if(typeof e!="number"||!Lu(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+a),n.writeUInt16BE(e,0),typeof t=="string"?n.write(t,2):n.set(t,2)}}let o={[xe]:n.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==ke?this.enqueue([this.dispatch,n,!1,o,i]):this.sendFrame(r.frame(n,o),i)}ping(e,t,s){let i,n;if(typeof e=="string"?(i=Buffer.byteLength(e),n=!1):zt(e)?(i=e.size,n=!1):(e=lt(e),i=e.length,n=lt.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[xe]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:n,rsv1:!1};zt(e)?this._state!==ke?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==ke?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}pong(e,t,s){let i,n;if(typeof e=="string"?(i=Buffer.byteLength(e),n=!1):zt(e)?(i=e.size,n=!1):(e=lt(e),i=e.length,n=lt.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[xe]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:n,rsv1:!1};zt(e)?this._state!==ke?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==ke?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}send(e,t,s){let i=this._extensions[Pl.extensionName],n=t.binary?2:1,o=t.compress,a,u;typeof e=="string"?(a=Buffer.byteLength(e),u=!1):zt(e)?(a=e.size,u=!1):(e=lt(e),a=e.length,u=lt.readOnly),this._firstFragment?(this._firstFragment=!1,o&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=i._threshold),this._compress=o):(o=!1,n=0),t.fin&&(this._firstFragment=!0);let l={[xe]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:n,readOnly:u,rsv1:o};zt(e)?this._state!==ke?this.enqueue([this.getBlobData,e,this._compress,l,s]):this.getBlobData(e,this._compress,l,s):this._state!==ke?this.enqueue([this.dispatch,e,this._compress,l,s]):this.dispatch(e,this._compress,l,s)}getBlobData(e,t,s,i){this._bufferedBytes+=s[xe],this._state=qu,e.arrayBuffer().then(n=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(eo,this,a,i);return}this._bufferedBytes-=s[xe];let o=lt(n);t?this.dispatch(o,t,s,i):(this._state=ke,this.sendFrame(r.frame(o,s),i),this.dequeue())}).catch(n=>{process.nextTick(Ru,this,n,i)})}dispatch(e,t,s,i){if(!t){this.sendFrame(r.frame(e,s),i);return}let n=this._extensions[Pl.extensionName];this._bufferedBytes+=s[xe],this._state=Du,n.compress(e,s.fin,(o,a)=>{if(this._socket.destroyed){let u=new Error("The socket was closed while data was being compressed");eo(this,u,i);return}this._bufferedBytes-=s[xe],this._state=ke,s.readOnly=!1,this.sendFrame(r.frame(a,s),i),this.dequeue()})}dequeue(){for(;this._state===ke&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][xe],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][xe],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};Al.exports=Yn;function eo(r,e,t){typeof t=="function"&&t(e);for(let s=0;s<r._queue.length;s++){let i=r._queue[s],n=i[i.length-1];typeof n=="function"&&n(e)}}function Ru(r,e,t){eo(r,e,t),r.onerror(e)}});var Bl=ee((dv,Ml)=>{"use strict";var{kForOnEventAttribute:Or,kListener:ro}=Fe(),$l=Symbol("kCode"),Il=Symbol("kData"),Ll=Symbol("kError"),jl=Symbol("kMessage"),Dl=Symbol("kReason"),Qt=Symbol("kTarget"),ql=Symbol("kType"),Rl=Symbol("kWasClean"),Ue=class{constructor(e){this[Qt]=null,this[ql]=e}get target(){return this[Qt]}get type(){return this[ql]}};Object.defineProperty(Ue.prototype,"target",{enumerable:!0});Object.defineProperty(Ue.prototype,"type",{enumerable:!0});var ut=class extends Ue{constructor(e,t={}){super(e),this[$l]=t.code===void 0?0:t.code,this[Dl]=t.reason===void 0?"":t.reason,this[Rl]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[$l]}get reason(){return this[Dl]}get wasClean(){return this[Rl]}};Object.defineProperty(ut.prototype,"code",{enumerable:!0});Object.defineProperty(ut.prototype,"reason",{enumerable:!0});Object.defineProperty(ut.prototype,"wasClean",{enumerable:!0});var Wt=class extends Ue{constructor(e,t={}){super(e),this[Ll]=t.error===void 0?null:t.error,this[jl]=t.message===void 0?"":t.message}get error(){return this[Ll]}get message(){return this[jl]}};Object.defineProperty(Wt.prototype,"error",{enumerable:!0});Object.defineProperty(Wt.prototype,"message",{enumerable:!0});var Ar=class extends Ue{constructor(e,t={}){super(e),this[Il]=t.data===void 0?null:t.data}get data(){return this[Il]}};Object.defineProperty(Ar.prototype,"data",{enumerable:!0});var Mu={addEventListener(r,e,t={}){for(let i of this.listeners(r))if(!t[Or]&&i[ro]===e&&!i[Or])return;let s;if(r==="message")s=function(n,o){let a=new Ar("message",{data:o?n:n.toString()});a[Qt]=this,Ns(e,this,a)};else if(r==="close")s=function(n,o){let a=new ut("close",{code:n,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Qt]=this,Ns(e,this,a)};else if(r==="error")s=function(n){let o=new Wt("error",{error:n,message:n.message});o[Qt]=this,Ns(e,this,o)};else if(r==="open")s=function(){let n=new Ue("open");n[Qt]=this,Ns(e,this,n)};else return;s[Or]=!!t[Or],s[ro]=e,t.once?this.once(r,s):this.on(r,s)},removeEventListener(r,e){for(let t of this.listeners(r))if(t[ro]===e&&!t[Or]){this.removeListener(r,t);break}}};Ml.exports={CloseEvent:ut,ErrorEvent:Wt,Event:Ue,EventTarget:Mu,MessageEvent:Ar};function Ns(r,e,t){typeof r=="object"&&r.handleEvent?r.handleEvent.call(r,t):r.call(e,t)}});var so=ee((hv,Fl)=>{"use strict";var{tokenChars:$r}=Vt();function Le(r,e,t){r[e]===void 0?r[e]=[t]:r[e].push(t)}function Bu(r){let e=Object.create(null),t=Object.create(null),s=!1,i=!1,n=!1,o,a,u=-1,l=-1,c=-1,h=0;for(;h<r.length;h++)if(l=r.charCodeAt(h),o===void 0)if(c===-1&&$r[l]===1)u===-1&&(u=h);else if(h!==0&&(l===32||l===9))c===-1&&u!==-1&&(c=h);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h);let N=r.slice(u,c);l===44?(Le(e,N,t),t=Object.create(null)):o=N,u=c=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(a===void 0)if(c===-1&&$r[l]===1)u===-1&&(u=h);else if(l===32||l===9)c===-1&&u!==-1&&(c=h);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h),Le(t,r.slice(u,c),!0),l===44&&(Le(e,o,t),t=Object.create(null),o=void 0),u=c=-1}else if(l===61&&u!==-1&&c===-1)a=r.slice(u,h),u=c=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(i){if($r[l]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);u===-1?u=h:s||(s=!0),i=!1}else if(n)if($r[l]===1)u===-1&&(u=h);else if(l===34&&u!==-1)n=!1,c=h;else if(l===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(l===34&&r.charCodeAt(h-1)===61)n=!0;else if(c===-1&&$r[l]===1)u===-1&&(u=h);else if(u!==-1&&(l===32||l===9))c===-1&&(c=h);else if(l===59||l===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h);let N=r.slice(u,c);s&&(N=N.replace(/\\/g,""),s=!1),Le(t,a,N),l===44&&(Le(e,o,t),t=Object.create(null),o=void 0),a=void 0,u=c=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(u===-1||n||l===32||l===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=h);let g=r.slice(u,c);return o===void 0?Le(e,g,t):(a===void 0?Le(t,g,!0):s?Le(t,a,g.replace(/\\/g,"")):Le(t,a,g),Le(e,o,t)),e}function Fu(r){return Object.keys(r).map(e=>{let t=r[e];return Array.isArray(t)||(t=[t]),t.map(s=>[e].concat(Object.keys(s).map(i=>{let n=s[i];return Array.isArray(n)||(n=[n]),n.map(o=>o===!0?i:`${i}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Fl.exports={format:Fu,parse:Bu}});var Ps=ee((gv,Yl)=>{"use strict";var Vu=require("events"),zu=require("https"),Uu=require("http"),Ul=require("net"),Qu=require("tls"),{randomBytes:Wu,createHash:Ku}=require("crypto"),{Duplex:mv,Readable:pv}=require("stream"),{URL:io}=require("url"),et=Pr(),Zu=Xn(),Gu=to(),{isBlob:Ju}=Vt(),{BINARY_TYPES:Vl,EMPTY_BUFFER:Cs,GUID:Hu,kForOnEventAttribute:no,kListener:Xu,kStatusCode:Yu,kWebSocket:Y,NOOP:Ql}=Fe(),{EventTarget:{addEventListener:ef,removeEventListener:tf}}=Bl(),{format:rf,parse:sf}=so(),{toBuffer:nf}=Er(),of=30*1e3,Wl=Symbol("kAborted"),oo=[8,13],Qe=["CONNECTING","OPEN","CLOSING","CLOSED"],af=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,F=class r extends Vu{constructor(e,t,s){super(),this._binaryType=Vl[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Cs,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=r.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(s=t,t=[]):t=[t]),Kl(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Vl.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){let i=new Zu({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),n=new Gu(e,this._extensions,s.generateMask);this._receiver=i,this._sender=n,this._socket=e,i[Y]=this,n[Y]=this,e[Y]=this,i.on("conclude",uf),i.on("drain",ff),i.on("error",df),i.on("message",hf),i.on("ping",mf),i.on("pong",pf),n.onerror=gf,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Jl),e.on("data",ks),e.on("end",Hl),e.on("error",Xl),this._readyState=r.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[et.extensionName]&&this._extensions[et.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){ye(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===r.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Gl(this)}}pause(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){ao(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||Cs,t,s)}pong(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){ao(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||Cs,t,s)}resume(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(s=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){ao(this,e,s);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[et.extensionName]||(i.compress=!1),this._sender.send(e||Cs,i,s)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){ye(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=r.CLOSING,this._socket.destroy())}}};Object.defineProperty(F,"CONNECTING",{enumerable:!0,value:Qe.indexOf("CONNECTING")});Object.defineProperty(F.prototype,"CONNECTING",{enumerable:!0,value:Qe.indexOf("CONNECTING")});Object.defineProperty(F,"OPEN",{enumerable:!0,value:Qe.indexOf("OPEN")});Object.defineProperty(F.prototype,"OPEN",{enumerable:!0,value:Qe.indexOf("OPEN")});Object.defineProperty(F,"CLOSING",{enumerable:!0,value:Qe.indexOf("CLOSING")});Object.defineProperty(F.prototype,"CLOSING",{enumerable:!0,value:Qe.indexOf("CLOSING")});Object.defineProperty(F,"CLOSED",{enumerable:!0,value:Qe.indexOf("CLOSED")});Object.defineProperty(F.prototype,"CLOSED",{enumerable:!0,value:Qe.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(r=>{Object.defineProperty(F.prototype,r,{enumerable:!0})});["open","error","close","message"].forEach(r=>{Object.defineProperty(F.prototype,`on${r}`,{enumerable:!0,get(){for(let e of this.listeners(r))if(e[no])return e[Xu];return null},set(e){for(let t of this.listeners(r))if(t[no]){this.removeListener(r,t);break}typeof e=="function"&&this.addEventListener(r,e,{[no]:!0})}})});F.prototype.addEventListener=ef;F.prototype.removeEventListener=tf;Yl.exports=F;function Kl(r,e,t,s){let i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:oo[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(r._autoPong=i.autoPong,!oo.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${oo.join(", ")})`);let n;if(e instanceof io)n=e;else try{n=new io(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}n.protocol==="http:"?n.protocol="ws:":n.protocol==="https:"&&(n.protocol="wss:"),r._url=n.href;let o=n.protocol==="wss:",a=n.protocol==="ws+unix:",u;if(n.protocol!=="ws:"&&!o&&!a?u=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!n.pathname?u="The URL's pathname is empty":n.hash&&(u="The URL contains a fragment identifier"),u){let T=new SyntaxError(u);if(r._redirects===0)throw T;Es(r,T);return}let l=o?443:80,c=Wu(16).toString("base64"),h=o?zu.request:Uu.request,g=new Set,N;if(i.createConnection=i.createConnection||(o?cf:lf),i.defaultPort=i.defaultPort||l,i.port=n.port||l,i.host=n.hostname.startsWith("[")?n.hostname.slice(1,-1):n.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.path=n.pathname+n.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(N=new et(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=rf({[et.extensionName]:N.offer()})),t.length){for(let T of t){if(typeof T!="string"||!af.test(T)||g.has(T))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(T)}i.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(n.username||n.password)&&(i.auth=`${n.username}:${n.password}`),a){let T=i.path.split(":");i.socketPath=T[0],i.path=T[1]}let k;if(i.followRedirects){if(r._redirects===0){r._originalIpc=a,r._originalSecure=o,r._originalHostOrSocketPath=a?i.socketPath:n.host;let T=s&&s.headers;if(s={...s,headers:{}},T)for(let[I,L]of Object.entries(T))s.headers[I.toLowerCase()]=L}else if(r.listenerCount("redirect")===0){let T=a?r._originalIpc?i.socketPath===r._originalHostOrSocketPath:!1:r._originalIpc?!1:n.host===r._originalHostOrSocketPath;(!T||r._originalSecure&&!o)&&(delete i.headers.authorization,delete i.headers.cookie,T||delete i.headers.host,i.auth=void 0)}i.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),k=r._req=h(i),r._redirects&&r.emit("redirect",r.url,k)}else k=r._req=h(i);i.timeout&&k.on("timeout",()=>{ye(r,k,"Opening handshake has timed out")}),k.on("error",T=>{k===null||k[Wl]||(k=r._req=null,Es(r,T))}),k.on("response",T=>{let I=T.headers.location,L=T.statusCode;if(I&&i.followRedirects&&L>=300&&L<400){if(++r._redirects>i.maxRedirects){ye(r,k,"Maximum redirects exceeded");return}k.abort();let z;try{z=new io(I,e)}catch{let B=new SyntaxError(`Invalid URL: ${I}`);Es(r,B);return}Kl(r,z,t,s)}else r.emit("unexpected-response",k,T)||ye(r,k,`Unexpected server response: ${T.statusCode}`)}),k.on("upgrade",(T,I,L)=>{if(r.emit("upgrade",T),r.readyState!==F.CONNECTING)return;k=r._req=null;let z=T.headers.upgrade;if(z===void 0||z.toLowerCase()!=="websocket"){ye(r,I,"Invalid Upgrade header");return}let J=Ku("sha1").update(c+Hu).digest("base64");if(T.headers["sec-websocket-accept"]!==J){ye(r,I,"Invalid Sec-WebSocket-Accept header");return}let B=T.headers["sec-websocket-protocol"],ce;if(B!==void 0?g.size?g.has(B)||(ce="Server sent an invalid subprotocol"):ce="Server sent a subprotocol but none was requested":g.size&&(ce="Server sent no subprotocol"),ce){ye(r,I,ce);return}B&&(r._protocol=B);let G=T.headers["sec-websocket-extensions"];if(G!==void 0){if(!N){ye(r,I,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let A;try{A=sf(G)}catch{ye(r,I,"Invalid Sec-WebSocket-Extensions header");return}let $=Object.keys(A);if($.length!==1||$[0]!==et.extensionName){ye(r,I,"Server indicated an extension that was not requested");return}try{N.accept(A[et.extensionName])}catch{ye(r,I,"Invalid Sec-WebSocket-Extensions header");return}r._extensions[et.extensionName]=N}r.setSocket(I,L,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(k,r):k.end()}function Es(r,e){r._readyState=F.CLOSING,r._errorEmitted=!0,r.emit("error",e),r.emitClose()}function lf(r){return r.path=r.socketPath,Ul.connect(r)}function cf(r){return r.path=void 0,!r.servername&&r.servername!==""&&(r.servername=Ul.isIP(r.host)?"":r.host),Qu.connect(r)}function ye(r,e,t){r._readyState=F.CLOSING;let s=new Error(t);Error.captureStackTrace(s,ye),e.setHeader?(e[Wl]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Es,r,s)):(e.destroy(s),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function ao(r,e,t){if(e){let s=Ju(e)?e.size:nf(e).length;r._socket?r._sender._bufferedBytes+=s:r._bufferedAmount+=s}if(t){let s=new Error(`WebSocket is not open: readyState ${r.readyState} (${Qe[r.readyState]})`);process.nextTick(t,s)}}function uf(r,e){let t=this[Y];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,t._socket[Y]!==void 0&&(t._socket.removeListener("data",ks),process.nextTick(Zl,t._socket),r===1005?t.close():t.close(r,e))}function ff(){let r=this[Y];r.isPaused||r._socket.resume()}function df(r){let e=this[Y];e._socket[Y]!==void 0&&(e._socket.removeListener("data",ks),process.nextTick(Zl,e._socket),e.close(r[Yu])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",r))}function zl(){this[Y].emitClose()}function hf(r,e){this[Y].emit("message",r,e)}function mf(r){let e=this[Y];e._autoPong&&e.pong(r,!this._isServer,Ql),e.emit("ping",r)}function pf(r){this[Y].emit("pong",r)}function Zl(r){r.resume()}function gf(r){let e=this[Y];e.readyState!==F.CLOSED&&(e.readyState===F.OPEN&&(e._readyState=F.CLOSING,Gl(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",r)))}function Gl(r){r._closeTimer=setTimeout(r._socket.destroy.bind(r._socket),of)}function Jl(){let r=this[Y];this.removeListener("close",Jl),this.removeListener("data",ks),this.removeListener("end",Hl),r._readyState=F.CLOSING;let e;!this._readableState.endEmitted&&!r._closeFrameReceived&&!r._receiver._writableState.errorEmitted&&(e=r._socket.read())!==null&&r._receiver.write(e),r._receiver.end(),this[Y]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",zl),r._receiver.on("finish",zl))}function ks(r){this[Y]._receiver.write(r)||this.pause()}function Hl(){let r=this[Y];r._readyState=F.CLOSING,r._receiver.end(),this.end()}function Xl(){let r=this[Y];this.removeListener("error",Xl),this.on("error",Ql),r&&(r._readyState=F.CLOSING,this.destroy())}});var sc=ee((_v,rc)=>{"use strict";var yv=Ps(),{Duplex:yf}=require("stream");function ec(r){r.emit("close")}function _f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function tc(r){this.removeListener("error",tc),this.destroy(),this.listenerCount("error")===0&&this.emit("error",r)}function bf(r,e){let t=!0,s=new yf({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return r.on("message",function(n,o){let a=!o&&s._readableState.objectMode?n.toString():n;s.push(a)||r.pause()}),r.once("error",function(n){s.destroyed||(t=!1,s.destroy(n))}),r.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(i,n){if(r.readyState===r.CLOSED){n(i),process.nextTick(ec,s);return}let o=!1;r.once("error",function(u){o=!0,n(u)}),r.once("close",function(){o||n(i),process.nextTick(ec,s)}),t&&r.terminate()},s._final=function(i){if(r.readyState===r.CONNECTING){r.once("open",function(){s._final(i)});return}r._socket!==null&&(r._socket._writableState.finished?(i(),s._readableState.endEmitted&&s.destroy()):(r._socket.once("finish",function(){i()}),r.close()))},s._read=function(){r.isPaused&&r.resume()},s._write=function(i,n,o){if(r.readyState===r.CONNECTING){r.once("open",function(){s._write(i,n,o)});return}r.send(i,o)},s.on("end",_f),s.on("error",tc),s}rc.exports=bf});var nc=ee((bv,ic)=>{"use strict";var{tokenChars:vf}=Vt();function wf(r){let e=new Set,t=-1,s=-1,i=0;for(i;i<r.length;i++){let o=r.charCodeAt(i);if(s===-1&&vf[o]===1)t===-1&&(t=i);else if(i!==0&&(o===32||o===9))s===-1&&t!==-1&&(s=i);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${i}`);s===-1&&(s=i);let a=r.slice(t,s);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=s=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(t===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let n=r.slice(t,i);if(e.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);return e.add(n),e}ic.exports={parse:wf}});var dc=ee((wv,fc)=>{"use strict";var xf=require("events"),Os=require("http"),{Duplex:vv}=require("stream"),{createHash:Sf}=require("crypto"),oc=so(),ft=Pr(),Tf=nc(),Nf=Ps(),{GUID:Cf,kWebSocket:Ef}=Fe(),kf=/^[+/0-9A-Za-z]{22}==$/,ac=0,lc=1,uc=2,lo=class extends xf{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Nf,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Os.createServer((s,i)=>{let n=Os.STATUS_CODES[426];i.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),i.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=Pf(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,n,o)=>{this.handleUpgrade(i,n,o,s)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=ac}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===uc){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Ir,this);return}if(e&&this.once("close",e),this._state!==lc)if(this._state=lc,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Ir,this):process.nextTick(Ir,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Ir(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,i){t.on("error",cc);let n=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){dt(this,e,t,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){dt(this,e,t,400,"Invalid Upgrade header");return}if(n===void 0||!kf.test(n)){dt(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){dt(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){Lr(t,400);return}let u=e.headers["sec-websocket-protocol"],l=new Set;if(u!==void 0)try{l=Tf.parse(u)}catch{dt(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let c=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&c!==void 0){let g=new ft(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let N=oc.parse(c);N[ft.extensionName]&&(g.accept(N[ft.extensionName]),h[ft.extensionName]=g)}catch{dt(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(N,k,T,I)=>{if(!N)return Lr(t,k||401,T,I);this.completeUpgrade(h,n,l,e,t,s,i)});return}if(!this.options.verifyClient(g))return Lr(t,401)}this.completeUpgrade(h,n,l,e,t,s,i)}completeUpgrade(e,t,s,i,n,o,a){if(!n.readable||!n.writable)return n.destroy();if(n[Ef])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>ac)return Lr(n,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Sf("sha1").update(t+Cf).digest("base64")}`],c=new this.options.WebSocket(null,void 0,this.options);if(s.size){let h=this.options.handleProtocols?this.options.handleProtocols(s,i):s.values().next().value;h&&(l.push(`Sec-WebSocket-Protocol: ${h}`),c._protocol=h)}if(e[ft.extensionName]){let h=e[ft.extensionName].params,g=oc.format({[ft.extensionName]:[h]});l.push(`Sec-WebSocket-Extensions: ${g}`),c._extensions=e}this.emit("headers",l,i),n.write(l.concat(`\r
`).join(`\r
`)),n.removeListener("error",cc),c.setSocket(n,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Ir,this)})),a(c,i)}};fc.exports=lo;function Pf(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let s of Object.keys(e))r.removeListener(s,e[s])}}function Ir(r){r._state=uc,r.emit("close")}function cc(){this.destroy()}function Lr(r,e,t,s){t=t||Os.STATUS_CODES[e],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...s},r.once("finish",r.destroy),r.end(`HTTP/1.1 ${e} ${Os.STATUS_CODES[e]}\r
`+Object.keys(s).map(i=>`${i}: ${s[i]}`).join(`\r
`)+`\r
\r
`+t)}function dt(r,e,t,s,i,n){if(r.listenerCount("wsClientError")){let o=new Error(i);Error.captureStackTrace(o,dt),r.emit("wsClientError",o,t,e)}else Lr(t,s,i,n)}});var $c=require("@nestjs/core"),Ic=require("@nestjs/common");var Fs=require("@nestjs/common");var Ac=require("@nestjs/common");var R=require("@nestjs/common");var Fr=require("@nestjs/common");var it=class{requiredRole;constructor(e){this.requiredRole=e}canActivate(e){let s=e.switchToHttp().getRequest().user;if(!s||s.role!==this.requiredRole)throw new Fr.ForbiddenException(`Access denied. Requires ${this.requiredRole} role.`);return!0}};it=te([(0,Fr.Injectable)()],it);var Ce=class{constructor(e){this.issuesService=e}create(e,t){return this.issuesService.create(t,e.user)}findAll(e){return this.issuesService.findAll(e.user.organizationId)}findOne(e,t){return this.issuesService.findOne(+t,e.user.organizationId)}update(e,t,s){return this.issuesService.update(+t,s,e.user)}remove(e,t){return this.issuesService.remove(+t,e.user)}};te([(0,R.Post)(),Ne(0,(0,R.Req)()),Ne(1,(0,R.Body)())],Ce.prototype,"create",1),te([(0,R.Get)(),Ne(0,(0,R.Req)())],Ce.prototype,"findAll",1),te([(0,R.Get)(":id"),Ne(0,(0,R.Req)()),Ne(1,(0,R.Param)("id"))],Ce.prototype,"findOne",1),te([(0,R.Patch)(":id"),(0,R.UseGuards)(new it("ADMIN")),Ne(0,(0,R.Req)()),Ne(1,(0,R.Param)("id")),Ne(2,(0,R.Body)())],Ce.prototype,"update",1),te([(0,R.Delete)(":id"),(0,R.UseGuards)(new it("ADMIN")),(0,R.HttpCode)(204),Ne(0,(0,R.Req)()),Ne(1,(0,R.Param)("id"))],Ce.prototype,"remove",1),Ce=te([(0,R.Controller)("issues")],Ce);var Ms=require("@nestjs/common");var Rs=require("@neondatabase/serverless");var Mt=require("@neondatabase/serverless");var f=Symbol.for("drizzle:entityKind"),lh=Symbol.for("drizzle:hasOwnEntityKind");function m(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,f))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(f in t&&t[f]===e[f])return!0;t=Object.getPrototypeOf(t)}return!1}var Us=class{static[f]="ConsoleLogWriter";write(e){console.log(e)}},Vr=class{static[f]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Us}logQuery(e,t){let s=t.map(n=>{try{return JSON.stringify(n)}catch{return String(n)}}),i=s.length?` -- params: [${s.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},zr=class{static[f]="NoopLogger";logQuery(){}};var re=class{static[f]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var q=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[f]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Ur=class{static[f]="ColumnBuilder";config;constructor(e,t,s){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:s,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var Ee=Symbol.for("drizzle:Name");var Qr=class{static[f]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:s,columns:i,foreignColumns:n}=e();return{name:s,columns:i,foreignTable:n[0].table,foreignColumns:n}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Qs(e,this)}},Qs=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[f]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:s}=this.reference(),i=t.map(a=>a.name),n=s.map(a=>a.name),o=[this.table[Ee],...i,s[0].table[Ee],...n];return e??`${o.join("_")}_fk`}};function Wr(r,...e){return r(...e)}function Zs(r,e){return`${r[Ee]}_${e.join("_")}_unique`}var Ws=class{constructor(e,t){this.name=t,this.columns=e}static[f]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Ks(e,this.columns,this.nullsNotDistinctConfig,this.name)}},_o=class{static[f]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Ws(e,this.name)}},Ks=class{constructor(e,t,s,i){this.table=e,this.columns=t,this.name=i??Zs(this.table,this.columns.map(n=>n.name)),this.nullsNotDistinct=s}static[f]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function bo(r,e,t){for(let s=e;s<r.length;s++){let i=r[s];if(i==="\\"){s++;continue}if(i==='"')return[r.slice(e,s).replace(/\\/g,""),s+1];if(!t&&(i===","||i==="}"))return[r.slice(e,s).replace(/\\/g,""),s]}return[r.slice(e).replace(/\\/g,""),r.length]}function vo(r,e=0){let t=[],s=e,i=!1;for(;s<r.length;){let n=r[s];if(n===","){(i||s===e)&&t.push(""),i=!0,s++;continue}if(i=!1,n==="\\"){s+=2;continue}if(n==='"'){let[u,l]=bo(r,s+1,!0);t.push(u),s=l;continue}if(n==="}")return[t,s+1];if(n==="{"){let[u,l]=vo(r,s+1);t.push(u),s=l;continue}let[o,a]=bo(r,s,!1);t.push(o),s=a}return[t,s]}function wo(r){let[e]=vo(r,1);return e}function Gs(r){return`{${r.map(e=>Array.isArray(e)?Gs(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var x=class extends Ur{foreignKeyConfigs=[];static[f]="PgColumnBuilder";array(e){return new Hs(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:s,actions:i})=>Wr((n,o)=>{let a=new Qr(()=>{let u=n();return{columns:[e],foreignColumns:[u]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)},s,i))}buildExtraConfigColumn(e){return new Js(e,this.config)}},y=class extends q{constructor(e,t){t.uniqueName||(t.uniqueName=Zs(e,[t.name])),super(e,t),this.table=e}static[f]="PgColumn"},Js=class extends y{static[f]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},xo=class{static[f]="IndexedColumn";constructor(e,t,s,i){this.name=e,this.keyAsName=t,this.type=s,this.indexConfig=i}name;keyAsName;type;indexConfig},Hs=class extends x{static[f]="PgArrayBuilder";constructor(e,t,s){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=s}build(e){let t=this.config.baseBuilder.build(e);return new Xs(e,this.config,t)}},Xs=class r extends y{constructor(e,t,s,i){super(e,t),this.baseColumn=s,this.range=i,this.size=t.size}size;static[f]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=wo(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let s=e.map(i=>i===null?null:m(this.baseColumn,r)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return t?s:Gs(s)}};var So=Symbol.for("drizzle:isPgEnum");function No(r){return!!r&&typeof r=="function"&&So in r&&r[So]===!0}var To=class extends x{static[f]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new Ys(e,this.config)}},Ys=class extends y{static[f]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};var W=class{static[f]="Subquery";constructor(e,t,s,i=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:s,isWith:i}}},$t=class extends W{static[f]="WithSubquery"};var Co="0.39.3";var ei,ti,K={startActiveSpan(r,e){return ei?(ti||(ti=ei.trace.getTracer("drizzle-orm",Co)),Wr((t,s)=>s.startActiveSpan(r,i=>{try{return e(i)}catch(n){throw i.setStatus({code:t.SpanStatusCode.ERROR,message:n instanceof Error?n.message:"Unknown error"}),n}finally{i.end()}}),ei,ti)):e()}};var M=Symbol.for("drizzle:ViewBaseConfig");var Kr=Symbol.for("drizzle:Schema"),Zr=Symbol.for("drizzle:Columns"),Eo=Symbol.for("drizzle:ExtraConfigColumns"),ri=Symbol.for("drizzle:OriginalName"),si=Symbol.for("drizzle:BaseName"),or=Symbol.for("drizzle:IsAlias"),ko=Symbol.for("drizzle:ExtraConfigBuilder"),Po=Symbol.for("drizzle:IsDrizzleTable"),b=class{static[f]="Table";static Symbol={Name:Ee,Schema:Kr,OriginalName:ri,Columns:Zr,ExtraConfigColumns:Eo,BaseName:si,IsAlias:or,ExtraConfigBuilder:ko};[Ee];[ri];[Kr];[Zr];[Eo];[si];[or]=!1;[Po]=!0;[ko]=void 0;constructor(e,t,s){this[Ee]=this[ri]=e,this[Kr]=t,this[si]=s}};function ii(r){return typeof r=="object"&&r!==null&&Po in r}function ue(r){return r[Ee]}function nt(r){return`${r[Kr]??"public"}.${r[Ee]}`}var Oo=class{static[f]="FakePrimitiveParam"};function ni(r){return r!=null&&typeof r.getSQL=="function"}function Vc(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Z=class{static[f]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new w([this])}},w=class r{constructor(e){this.queryChunks=e}static[f]="SQL";decoder=$o;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return K.startActiveSpan("drizzle.buildSQL",t=>{let s=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(e,t){let s=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:i,escapeName:n,escapeParam:o,prepareTyping:a,inlineParams:u,paramStartIndex:l}=s;return Vc(e.map(c=>{if(m(c,Z))return{sql:c.value.join(""),params:[]};if(m(c,ar))return{sql:n(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let h=[new Z("(")];for(let[g,N]of c.entries())h.push(N),g<c.length-1&&h.push(new Z(", "));return h.push(new Z(")")),this.buildQueryFromSourceParams(h,s)}if(m(c,r))return this.buildQueryFromSourceParams(c.queryChunks,{...s,inlineParams:u||c.shouldInlineParams});if(m(c,b)){let h=c[b.Symbol.Schema],g=c[b.Symbol.Name];return{sql:h===void 0||c[or]?n(g):n(h)+"."+n(g),params:[]}}if(m(c,q)){let h=i.getColumnCasing(c);if(t.invokeSource==="indexes")return{sql:n(h),params:[]};let g=c.table[b.Symbol.Schema];return{sql:c.table[or]||g===void 0?n(c.table[b.Symbol.Name])+"."+n(h):n(g)+"."+n(c.table[b.Symbol.Name])+"."+n(h),params:[]}}if(m(c,ne)){let h=c[M].schema,g=c[M].name;return{sql:h===void 0||c[M].isAlias?n(g):n(h)+"."+n(g),params:[]}}if(m(c,fe)){if(m(c.value,Re))return{sql:o(l.value++,c),params:[c],typings:["none"]};let h=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(m(h,r))return this.buildQueryFromSourceParams([h],s);if(u)return{sql:this.mapInlineParam(h,s),params:[]};let g=["none"];return a&&(g=[a(c.encoder)]),{sql:o(l.value++,h),params:[h],typings:g}}return m(c,Re)?{sql:o(l.value++,c),params:[c],typings:["none"]}:m(c,r.Aliased)&&c.fieldAlias!==void 0?{sql:n(c.fieldAlias),params:[]}:m(c,W)?c._.isWith?{sql:n(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Z("("),c._.sql,new Z(") "),new ar(c._.alias)],s):No(c)?c.schema?{sql:n(c.schema)+"."+n(c.enumName),params:[]}:{sql:n(c.enumName),params:[]}:ni(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],s):this.buildQueryFromSourceParams([new Z("("),c.getSQL(),new Z(")")],s):u?{sql:this.mapInlineParam(c,s),params:[]}:{sql:o(l.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let s=e.toString();return t(s==="[object Object]"?JSON.stringify(e):s)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},ar=class{constructor(e){this.value=e}static[f]="Name";brand;getSQL(){return new w([this])}};function Ao(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var $o={mapFromDriverValue:r=>r},Io={mapToDriverValue:r=>r},tm={...$o,...Io},fe=class{constructor(e,t=Io){this.value=e,this.encoder=t}static[f]="Param";brand;getSQL(){return new w([this])}};function d(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Z(r[0]));for(let[s,i]of e.entries())t.push(i,new Z(r[s+1]));return new w(t)}(r=>{function e(){return new w([])}r.empty=e;function t(u){return new w(u)}r.fromList=t;function s(u){return new w([new Z(u)])}r.raw=s;function i(u,l){let c=[];for(let[h,g]of u.entries())h>0&&l!==void 0&&c.push(l),c.push(g);return new w(c)}r.join=i;function n(u){return new ar(u)}r.identifier=n;function o(u){return new Re(u)}r.placeholder=o;function a(u,l){return new fe(u,l)}r.param=a})(d||(d={}));(r=>{class e{constructor(s,i){this.sql=s,this.fieldAlias=i}static[f]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(w||(w={}));var Re=class{constructor(e){this.name=e}static[f]="Placeholder";getSQL(){return new w([this])}};function Gr(r,e){return r.map(t=>{if(m(t,Re)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(m(t,fe)&&m(t.value,Re)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var Lo=Symbol.for("drizzle:IsDrizzleView"),ne=class{static[f]="View";[M];[Lo]=!0;constructor({name:e,schema:t,selectedFields:s,query:i}){this[M]={name:e,originalName:e,schema:t,selectedFields:s,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new w([this])}};function jo(r){return typeof r=="object"&&r!==null&&Lo in r}q.prototype.getSQL=function(){return new w([this])};b.prototype.getSQL=function(){return new w([this])};W.prototype.getSQL=function(){return new w([this])};var ot=class{constructor(e){this.table=e}static[f]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},It=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[f]="TableAliasProxyHandler";get(e,t){if(t===b.Symbol.IsAlias)return!0;if(t===b.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===b.Symbol.OriginalName)return this.alias;if(t===M)return{...e[M],name:this.alias,isAlias:!0};if(t===b.Symbol.Columns){let i=e[b.Symbol.Columns];if(!i)return i;let n={};return Object.keys(i).map(o=>{n[o]=new Proxy(i[o],new ot(new Proxy(e,this)))}),n}let s=e[t];return m(s,q)?new Proxy(s,new ot(new Proxy(e,this))):s}},Do=class{constructor(e){this.alias=e}static[f]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?lr(e.sourceTable,this.alias):e[t]}};function lr(r,e){return new Proxy(r,new It(e,!1))}function Oe(r,e){return new Proxy(r,new ot(new Proxy(r.table,new It(e,!1))))}function oi(r,e){return new w.Aliased(cr(r.sql,e),r.fieldAlias)}function cr(r,e){return d.join(r.queryChunks.map(t=>m(t,q)?Oe(t,e):m(t,w)?cr(t,e):m(t,w.Aliased)?oi(t,e):t))}var U=class r{static[f]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===M)return{...e[M],selectedFields:new Proxy(e[M].selectedFields,this)};if(typeof t=="symbol")return e[t];let i=(m(e,W)?e._.selectedFields:m(e,ne)?e[M].selectedFields:e)[t];if(m(i,w.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let n=i.clone();return n.isSelectionField=!0,n}if(m(i,w)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return m(i,q)?this.config.alias?new Proxy(i,new ot(new Proxy(i.table,new It(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new r(this.config))}};function qo(r,e,t){let s={},i=r.reduce((n,{path:o,field:a},u)=>{let l;m(a,q)?l=a:m(a,w)?l=a.decoder:l=a.sql.decoder;let c=n;for(let[h,g]of o.entries())if(h<o.length-1)g in c||(c[g]={}),c=c[g];else{let N=e[u],k=c[g]=N===null?null:l.mapFromDriverValue(N);if(t&&m(a,q)&&o.length===2){let T=o[0];T in s?typeof s[T]=="string"&&s[T]!==ue(a.table)&&(s[T]=!1):s[T]=k===null?ue(a.table):!1}}return n},{});if(t&&Object.keys(s).length>0)for(let[n,o]of Object.entries(s))typeof o=="string"&&!t[o]&&(i[n]=null);return i}function ve(r,e){return Object.entries(r).reduce((t,[s,i])=>{if(typeof s!="string")return t;let n=e?[...e,s]:[s];return m(i,q)||m(i,w)||m(i,w.Aliased)?t.push({path:n,field:i}):m(i,b)?t.push(...ve(i[b.Symbol.Columns],n)):t.push(...ve(i,n)),t},[])}function ur(r,e){let t=Object.keys(r),s=Object.keys(e);if(t.length!==s.length)return!1;for(let[i,n]of t.entries())if(n!==s[i])return!1;return!0}function Jr(r,e){let t=Object.entries(e).filter(([,s])=>s!==void 0).map(([s,i])=>m(i,w)||m(i,q)?[s,i]:[s,new fe(i,r[b.Symbol.Columns][s])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Ro(r,e){for(let t of e)for(let s of Object.getOwnPropertyNames(t.prototype))s!=="constructor"&&Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}function Hr(r){return r[b.Symbol.Columns]}function Mo(r){return r[M].selectedFields}function Me(r){return m(r,W)?r._.alias:m(r,ne)?r[M].name:m(r,w)?void 0:r[b.Symbol.IsAlias]?r[b.Symbol.Name]:r[b.Symbol.BaseName]}function j(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function Bo(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var fr=class extends re{constructor(e,t,s,i){super(),this.session=t,this.dialect=s,this.config={table:e,withList:i}}static[f]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ve(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return K.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>K.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ue(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function zc(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function Uc(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,s,i)=>{let n=i===0?s.toLowerCase():`${s[0].toUpperCase()}${s.slice(1)}`;return t+n},"")}function Qc(r){return r}var Xr=class{static[f]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?zc:e==="camelCase"?Uc:Qc}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[b.Symbol.Schema]??"public",s=e.table[b.Symbol.OriginalName],i=`${t}.${s}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let t=e[b.Symbol.Schema]??"public",s=e[b.Symbol.OriginalName],i=`${t}.${s}`;if(!this.cachedTables[i]){for(let n of Object.values(e[b.Symbol.Columns])){let o=`${i}.${n.name}`;this.cache[o]=this.convert(n.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var dr=class extends Error{static[f]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Yr=class extends dr{static[f]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var Be=class extends x{static[f]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...s}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:s}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...s}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:s}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ai=class extends Be{static[f]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new li(e,this.config)}},li=class extends y{static[f]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},ci=class extends Be{static[f]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new ui(e,this.config)}},ui=class extends y{static[f]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function Fo(r,e){let{name:t,config:s}=j(r,e);return s.mode==="number"?new ai(t):new ci(t)}var fi=class extends x{static[f]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new di(e,this.config)}},di=class extends y{static[f]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},hi=class extends x{static[f]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new mi(e,this.config)}},mi=class extends y{static[f]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function Vo(r,e){let{name:t,config:s}=j(r,e);return s.mode==="number"?new fi(t):new hi(t)}var pi=class extends x{static[f]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new gi(e,this.config)}},gi=class extends y{static[f]="PgBoolean";getSQLType(){return"boolean"}};function zo(r){return new pi(r??"")}var yi=class extends x{static[f]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new _i(e,this.config)}},_i=class extends y{static[f]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function Uo(r,e={}){let{name:t,config:s}=j(r,e);return new yi(t,s)}var bi=class extends x{static[f]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new vi(e,this.config)}},vi=class extends y{static[f]="PgCidr";getSQLType(){return"cidr"}};function Qo(r){return new bi(r??"")}var wi=class extends x{static[f]="PgCustomColumnBuilder";constructor(e,t,s){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=s}build(e){return new xi(e,this.config)}},xi=class extends y{static[f]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Wo(r){return(e,t)=>{let{name:s,config:i}=j(e,t);return new wi(s,i,r)}}var Ae=class extends x{static[f]="PgDateColumnBaseBuilder";defaultNow(){return this.default(d`now()`)}};var Si=class extends Ae{static[f]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new hr(e,this.config)}},hr=class extends y{static[f]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ti=class extends Ae{static[f]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new mr(e,this.config)}},mr=class extends y{static[f]="PgDateString";getSQLType(){return"date"}};function Ko(r,e){let{name:t,config:s}=j(r,e);return s?.mode==="date"?new Si(t):new Ti(t)}var Ni=class extends x{static[f]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ci(e,this.config)}},Ci=class extends y{static[f]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Zo(r){return new Ni(r??"")}var Ei=class extends x{static[f]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new ki(e,this.config)}},ki=class extends y{static[f]="PgInet";getSQLType(){return"inet"}};function Go(r){return new Ei(r??"")}var Pi=class extends Be{static[f]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Oi(e,this.config)}},Oi=class extends y{static[f]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function es(r){return new Pi(r??"")}var Ai=class extends x{static[f]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new $i(e,this.config)}},$i=class extends y{static[f]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}};function Jo(r,e={}){let{name:t,config:s}=j(r,e);return new Ai(t,s)}var Ii=class extends x{static[f]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new pr(e,this.config)}},pr=class extends y{static[f]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Ho(r){return new Ii(r??"")}var Li=class extends x{static[f]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gr(e,this.config)}},gr=class extends y{static[f]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Xo(r){return new Li(r??"")}var ji=class extends x{static[f]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Di(e,this.config)}},Di=class extends y{static[f]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,s,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(s),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},qi=class extends x{static[f]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Ri(e,this.config)}},Ri=class extends y{static[f]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,s,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(s),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Yo(r,e){let{name:t,config:s}=j(r,e);return!s?.mode||s.mode==="tuple"?new ji(t):new qi(t)}var Mi=class extends x{static[f]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Bi(e,this.config)}},Bi=class extends y{static[f]="PgMacaddr";getSQLType(){return"macaddr"}};function ea(r){return new Mi(r??"")}var Fi=class extends x{static[f]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Vi(e,this.config)}},Vi=class extends y{static[f]="PgMacaddr8";getSQLType(){return"macaddr8"}};function ta(r){return new Fi(r??"")}var zi=class extends x{static[f]="PgNumericBuilder";constructor(e,t,s){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=s}build(e){return new yr(e,this.config)}},yr=class extends y{static[f]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function ra(r,e){let{name:t,config:s}=j(r,e);return new zi(t,s?.precision,s?.scale)}var Ui=class extends x{static[f]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Qi(e,this.config)}},Qi=class extends y{static[f]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(s)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wi=class extends x{static[f]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Ki(e,this.config)}},Ki=class extends y{static[f]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,s]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(s)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function sa(r,e){let{name:t,config:s}=j(r,e);return!s?.mode||s.mode==="tuple"?new Ui(t):new Wi(t)}function Wc(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function ia(r,e){let t=new ArrayBuffer(8),s=new DataView(t);for(let i=0;i<8;i++)s.setUint8(i,r[e+i]);return s.getFloat64(0,!0)}function Zi(r){let e=Wc(r),t=0,s=e[t];t+=1;let i=new DataView(e.buffer),n=i.getUint32(t,s===1);t+=4;let o;if(n&536870912&&(o=i.getUint32(t,s===1),t+=4),(n&65535)===1){let a=ia(e,t);t+=8;let u=ia(e,t);return t+=8,[a,u]}throw new Error("Unsupported geometry type")}var Gi=class extends x{static[f]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new Ji(e,this.config)}},Ji=class extends y{static[f]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Zi(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},Hi=class extends x{static[f]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Xi(e,this.config)}},Xi=class extends y{static[f]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=Zi(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function na(r,e){let{name:t,config:s}=j(r,e);return!s?.mode||s.mode==="tuple"?new Gi(t):new Hi(t)}var Yi=class extends x{static[f]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new en(e,this.config)}},en=class extends y{static[f]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function oa(r){return new Yi(r??"")}var tn=class extends x{static[f]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new rn(e,this.config)}},rn=class extends y{static[f]="PgSerial";getSQLType(){return"serial"}};function _r(r){return new tn(r??"")}var sn=class extends Be{static[f]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new nn(e,this.config)}},nn=class extends y{static[f]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function aa(r){return new sn(r??"")}var on=class extends x{static[f]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new an(e,this.config)}},an=class extends y{static[f]="PgSmallSerial";getSQLType(){return"smallserial"}};function la(r){return new on(r??"")}var ln=class extends x{static[f]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new cn(e,this.config)}},cn=class extends y{static[f]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function de(r,e={}){let{name:t,config:s}=j(r,e);return new ln(t,s)}var un=class extends Ae{constructor(e,t,s){super(e,"string","PgTime"),this.withTimezone=t,this.precision=s,this.config.withTimezone=t,this.config.precision=s}static[f]="PgTimeBuilder";build(e){return new br(e,this.config)}},br=class extends y{static[f]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function ca(r,e={}){let{name:t,config:s}=j(r,e);return new un(t,s.withTimezone??!1,s.precision)}var fn=class extends Ae{static[f]="PgTimestampBuilder";constructor(e,t,s){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=s}build(e){return new vr(e,this.config)}},vr=class extends y{static[f]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},dn=class extends Ae{static[f]="PgTimestampStringBuilder";constructor(e,t,s){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=s}build(e){return new wr(e,this.config)}},wr=class extends y{static[f]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function Lt(r,e={}){let{name:t,config:s}=j(r,e);return s?.mode==="string"?new dn(t,s.withTimezone??!1,s.precision):new fn(t,s?.withTimezone??!1,s?.precision)}var hn=class extends x{static[f]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(d`gen_random_uuid()`)}build(e){return new xr(e,this.config)}},xr=class extends y{static[f]="PgUUID";getSQLType(){return"uuid"}};function ua(r){return new hn(r??"")}var mn=class extends x{static[f]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new pn(e,this.config)}},pn=class extends y{static[f]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function fa(r,e={}){let{name:t,config:s}=j(r,e);return new mn(t,s)}var gn=class extends x{static[f]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new yn(e,this.config)}},yn=class extends y{static[f]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function da(r,e){let{name:t,config:s}=j(r,e);return new gn(t,s)}var _n=class extends x{static[f]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new bn(e,this.config)}},bn=class extends y{static[f]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function ha(r,e){let{name:t,config:s}=j(r,e);return new _n(t,s)}var vn=class extends x{static[f]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new wn(e,this.config)}},wn=class extends y{static[f]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function ma(r,e){let{name:t,config:s}=j(r,e);return new vn(t,s)}var xn=class extends x{static[f]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new Sn(e,this.config)}},Sn=class extends y{static[f]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function pa(r,e){let{name:t,config:s}=j(r,e);return new xn(t,s)}function ga(){return{bigint:Fo,bigserial:Vo,boolean:zo,char:Uo,cidr:Qo,customType:Wo,date:Ko,doublePrecision:Zo,inet:Go,integer:es,interval:Jo,json:Ho,jsonb:Xo,line:Yo,macaddr:ea,macaddr8:ta,numeric:ra,point:sa,geometry:na,real:oa,serial:_r,smallint:aa,smallserial:la,text:de,time:ca,timestamp:Lt,uuid:ua,varchar:fa,bit:da,halfvec:ha,sparsevec:ma,vector:pa}}var Tn=Symbol.for("drizzle:PgInlineForeignKeys"),ya=Symbol.for("drizzle:EnableRLS"),X=class extends b{static[f]="PgTable";static Symbol=Object.assign({},b.Symbol,{InlineForeignKeys:Tn,EnableRLS:ya});[Tn]=[];[ya]=!1;[b.Symbol.ExtraConfigBuilder]=void 0};function Kc(r,e,t,s,i=r){let n=new X(r,s,i),o=typeof e=="function"?e(ga()):e,a=Object.fromEntries(Object.entries(o).map(([c,h])=>{let g=h;g.setName(c);let N=g.build(n);return n[Tn].push(...g.buildForeignKeys(N,n)),[c,N]})),u=Object.fromEntries(Object.entries(o).map(([c,h])=>{let g=h;g.setName(c);let N=g.buildExtraConfigColumn(n);return[c,N]})),l=Object.assign(n,a);return l[b.Symbol.Columns]=a,l[b.Symbol.ExtraConfigColumns]=u,t&&(l[X.Symbol.ExtraConfigBuilder]=t),Object.assign(l,{enableRLS:()=>(l[X.Symbol.EnableRLS]=!0,l)})}var Nn=(r,e,t)=>Kc(r,e,t,void 0);var ts=class{static[f]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Cn(e,this.columns,this.name)}},Cn=class{constructor(e,t,s){this.table=e,this.columns=t,this.name=s}static[f]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[X.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function he(r,e){return Ao(e)&&!ni(r)&&!m(r,fe)&&!m(r,Re)&&!m(r,q)&&!m(r,b)&&!m(r,ne)?new fe(r,e):r}var $e=(r,e)=>d`${r} = ${he(e,r)}`,_a=(r,e)=>d`${r} <> ${he(e,r)}`;function at(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new w(e):new w([new Z("("),d.join(e,new Z(" and ")),new Z(")")])}function ba(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new w(e):new w([new Z("("),d.join(e,new Z(" or ")),new Z(")")])}function va(r){return d`not ${r}`}var wa=(r,e)=>d`${r} > ${he(e,r)}`,xa=(r,e)=>d`${r} >= ${he(e,r)}`,Sa=(r,e)=>d`${r} < ${he(e,r)}`,Ta=(r,e)=>d`${r} <= ${he(e,r)}`;function Na(r,e){return Array.isArray(e)?e.length===0?d`false`:d`${r} in ${e.map(t=>he(t,r))}`:d`${r} in ${he(e,r)}`}function Ca(r,e){return Array.isArray(e)?e.length===0?d`true`:d`${r} not in ${e.map(t=>he(t,r))}`:d`${r} not in ${he(e,r)}`}function Ea(r){return d`${r} is null`}function ka(r){return d`${r} is not null`}function Pa(r){return d`exists ${r}`}function Oa(r){return d`not exists ${r}`}function Aa(r,e,t){return d`${r} between ${he(e,r)} and ${he(t,r)}`}function $a(r,e,t){return d`${r} not between ${he(e,r)} and ${he(t,r)}`}function Ia(r,e){return d`${r} like ${e}`}function La(r,e){return d`${r} not like ${e}`}function ja(r,e){return d`${r} ilike ${e}`}function Da(r,e){return d`${r} not ilike ${e}`}function qa(r){return d`${r} asc`}function rs(r){return d`${r} desc`}var ss=class{constructor(e,t,s){this.sourceTable=e,this.referencedTable=t,this.relationName=s,this.referencedTableName=t[b.Symbol.Name]}static[f]="Relation";referencedTableName;fieldName},En=class{constructor(e,t){this.table=e,this.config=t}static[f]="Relations"},He=class r extends ss{constructor(e,t,s,i){super(e,t,s?.relationName),this.config=s,this.isNullable=i}static[f]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Sr=class r extends ss{constructor(e,t,s){super(e,t,s?.relationName),this.config=s}static[f]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function Ra(){return{and:at,between:Aa,eq:$e,exists:Pa,gt:wa,gte:xa,ilike:ja,inArray:Na,isNull:Ea,isNotNull:ka,like:Ia,lt:Sa,lte:Ta,ne:_a,not:va,notBetween:$a,notExists:Oa,notLike:La,notIlike:Da,notInArray:Ca,or:ba,sql:d}}function Ma(){return{sql:d,asc:qa,desc:rs}}function Ba(r,e){Object.keys(r).length===1&&"default"in r&&!m(r.default,b)&&(r=r.default);let t={},s={},i={};for(let[n,o]of Object.entries(r))if(m(o,b)){let a=nt(o),u=s[a];t[a]=n,i[n]={tsName:n,dbName:o[b.Symbol.Name],schema:o[b.Symbol.Schema],columns:o[b.Symbol.Columns],relations:u?.relations??{},primaryKey:u?.primaryKey??[]};for(let c of Object.values(o[b.Symbol.Columns]))c.primary&&i[n].primaryKey.push(c);let l=o[b.Symbol.ExtraConfigBuilder]?.(o[b.Symbol.ExtraConfigColumns]);if(l)for(let c of Object.values(l))m(c,ts)&&i[n].primaryKey.push(...c.columns)}else if(m(o,En)){let a=nt(o.table),u=t[a],l=o.config(e(o.table)),c;for(let[h,g]of Object.entries(l))if(u){let N=i[u];N.relations[h]=g,c&&N.primaryKey.push(...c)}else a in s||(s[a]={relations:{},primaryKey:c}),s[a].relations[h]=g}return{tables:i,tableNamesMap:t}}function Zc(r){return function(t,s){return new He(r,t,s,s?.fields.reduce((i,n)=>i&&n.notNull,!0)??!1)}}function Gc(r){return function(t,s){return new Sr(r,t,s)}}function Fa(r,e,t){if(m(t,He)&&t.config)return{fields:t.config.fields,references:t.config.references};let s=e[nt(t.referencedTable)];if(!s)throw new Error(`Table "${t.referencedTable[b.Symbol.Name]}" not found in schema`);let i=r[s];if(!i)throw new Error(`Table "${s}" not found in schema`);let n=t.sourceTable,o=e[nt(n)];if(!o)throw new Error(`Table "${n[b.Symbol.Name]}" not found in schema`);let a=[];for(let u of Object.values(i.relations))(t.relationName&&t!==u&&u.relationName===t.relationName||!t.relationName&&u.referencedTable===t.sourceTable)&&a.push(u);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${t.sourceTable[b.Symbol.Name]}". Please specify relation name`);if(a[0]&&m(a[0],He)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function Va(r){return{one:Zc(r),many:Gc(r)}}function is(r,e,t,s,i=n=>n){let n={};for(let[o,a]of s.entries())if(a.isJson){let u=e.relations[a.tsKey],l=t[o],c=typeof l=="string"?JSON.parse(l):l;n[a.tsKey]=m(u,He)?c&&is(r,r[a.relationTableTsKey],c,a.selection,i):c.map(h=>is(r,r[a.relationTableTsKey],h,a.selection,i))}else{let u=i(t[o]),l=a.field,c;m(l,q)?c=l:m(l,w)?c=l.decoder:c=l.sql.decoder,n[a.tsKey]=u===null?null:c.mapFromDriverValue(u)}return n}var jt=class extends ne{static[f]="PgViewBase"};var Xe=class{static[f]="PgDialect";casing;constructor(e){this.casing=new Xr(e?.casing)}async migrate(e,t,s){let i=typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=typeof s=="string"?"drizzle":s.migrationsSchema??"drizzle",o=d`
			CREATE TABLE IF NOT EXISTS ${d.identifier(n)}.${d.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(d`CREATE SCHEMA IF NOT EXISTS ${d.identifier(n)}`),await t.execute(o);let u=(await t.all(d`select id, hash, created_at from ${d.identifier(n)}.${d.identifier(i)} order by created_at desc limit 1`))[0];await t.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let h of c.sql)await l.execute(d.raw(h));await l.execute(d`insert into ${d.identifier(n)}.${d.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[d`with `];for(let[s,i]of e.entries())t.push(d`${d.identifier(i._.alias)} as (${i._.sql})`),s<e.length-1&&t.push(d`, `);return t.push(d` `),d.join(t)}buildDeleteQuery({table:e,where:t,returning:s,withList:i}){let n=this.buildWithCTE(i),o=s?d` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,a=t?d` where ${t}`:void 0;return d`${n}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let s=e[b.Symbol.Columns],i=Object.keys(s).filter(o=>t[o]!==void 0||s[o]?.onUpdateFn!==void 0),n=i.length;return d.join(i.flatMap((o,a)=>{let u=s[o],l=t[o]??d.param(u.onUpdateFn(),u),c=d`${d.identifier(this.casing.getColumnCasing(u))} = ${l}`;return a<n-1?[c,d.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:t,where:s,returning:i,withList:n,from:o,joins:a}){let u=this.buildWithCTE(n),l=e[X.Symbol.Name],c=e[X.Symbol.Schema],h=e[X.Symbol.OriginalName],g=l===h?void 0:l,N=d`${c?d`${d.identifier(c)}.`:void 0}${d.identifier(h)}${g&&d` ${d.identifier(g)}`}`,k=this.buildUpdateSet(e,t),T=o&&d.join([d.raw(" from "),this.buildFromTable(o)]),I=this.buildJoins(a),L=i?d` returning ${this.buildSelection(i,{isSingleTable:!o})}`:void 0,z=s?d` where ${s}`:void 0;return d`${u}update ${N} set ${k}${T}${I}${z}${L}`}buildSelection(e,{isSingleTable:t=!1}={}){let s=e.length,i=e.flatMap(({field:n},o)=>{let a=[];if(m(n,w.Aliased)&&n.isSelectionField)a.push(d.identifier(n.fieldAlias));else if(m(n,w.Aliased)||m(n,w)){let u=m(n,w.Aliased)?n.sql:n;t?a.push(new w(u.queryChunks.map(l=>m(l,y)?d.identifier(this.casing.getColumnCasing(l)):l))):a.push(u),m(n,w.Aliased)&&a.push(d` as ${d.identifier(n.fieldAlias)}`)}else m(n,q)&&(t?a.push(d.identifier(this.casing.getColumnCasing(n))):a.push(n));return o<s-1&&a.push(d`, `),a});return d.join(i)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[s,i]of e.entries()){s===0&&t.push(d` `);let n=i.table,o=i.lateral?d` lateral`:void 0;if(m(n,X)){let a=n[X.Symbol.Name],u=n[X.Symbol.Schema],l=n[X.Symbol.OriginalName],c=a===l?void 0:i.alias;t.push(d`${d.raw(i.joinType)} join${o} ${u?d`${d.identifier(u)}.`:void 0}${d.identifier(l)}${c&&d` ${d.identifier(c)}`} on ${i.on}`)}else if(m(n,ne)){let a=n[M].name,u=n[M].schema,l=n[M].originalName,c=a===l?void 0:i.alias;t.push(d`${d.raw(i.joinType)} join${o} ${u?d`${d.identifier(u)}.`:void 0}${d.identifier(l)}${c&&d` ${d.identifier(c)}`} on ${i.on}`)}else t.push(d`${d.raw(i.joinType)} join${o} ${n} on ${i.on}`);s<e.length-1&&t.push(d` `)}return d.join(t)}buildFromTable(e){if(m(e,b)&&e[b.Symbol.OriginalName]!==e[b.Symbol.Name]){let t=d`${d.identifier(e[b.Symbol.OriginalName])}`;return e[b.Symbol.Schema]&&(t=d`${d.identifier(e[b.Symbol.Schema])}.${t}`),d`${t} ${d.identifier(e[b.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:s,where:i,having:n,table:o,joins:a,orderBy:u,groupBy:l,limit:c,offset:h,lockingClause:g,distinct:N,setOperators:k}){let T=s??ve(t);for(let ge of T)if(m(ge.field,q)&&ue(ge.field.table)!==(m(o,W)?o._.alias:m(o,jt)?o[M].name:m(o,w)?void 0:ue(o))&&!(qe=>a?.some(({alias:zs})=>zs===(qe[b.Symbol.IsAlias]?ue(qe):qe[b.Symbol.BaseName])))(ge.field.table)){let qe=ue(ge.field.table);throw new Error(`Your "${ge.path.join("->")}" field references a column "${qe}"."${ge.field.name}", but the table "${qe}" is not part of the query! Did you forget to join it?`)}let I=!a||a.length===0,L=this.buildWithCTE(e),z;N&&(z=N===!0?d` distinct`:d` distinct on (${d.join(N.on,d`, `)})`);let J=this.buildSelection(T,{isSingleTable:I}),B=this.buildFromTable(o),ce=this.buildJoins(a),G=i?d` where ${i}`:void 0,A=n?d` having ${n}`:void 0,$;u&&u.length>0&&($=d` order by ${d.join(u,d`, `)}`);let H;l&&l.length>0&&(H=d` group by ${d.join(l,d`, `)}`);let Ot=typeof c=="object"||typeof c=="number"&&c>=0?d` limit ${c}`:void 0,Vs=h?d` offset ${h}`:void 0,At=d.empty();if(g){let ge=d` for ${d.raw(g.strength)}`;g.config.of&&ge.append(d` of ${d.join(Array.isArray(g.config.of)?g.config.of:[g.config.of],d`, `)}`),g.config.noWait?ge.append(d` no wait`):g.config.skipLocked&&ge.append(d` skip locked`),At.append(ge)}let Je=d`${L}select${z} ${J} from ${B}${ce}${G}${H}${A}${$}${Ot}${Vs}${At}`;return k.length>0?this.buildSetOperations(Je,k):Je}buildSetOperations(e,t){let[s,...i]=t;if(!s)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:s}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:s,rightSelect:i,limit:n,orderBy:o,offset:a}}){let u=d`(${e.getSQL()}) `,l=d`(${i.getSQL()})`,c;if(o&&o.length>0){let k=[];for(let T of o)if(m(T,y))k.push(d.identifier(T.name));else if(m(T,w)){for(let I=0;I<T.queryChunks.length;I++){let L=T.queryChunks[I];m(L,y)&&(T.queryChunks[I]=d.identifier(L.name))}k.push(d`${T}`)}else k.push(d`${T}`);c=d` order by ${d.join(k,d`, `)} `}let h=typeof n=="object"||typeof n=="number"&&n>=0?d` limit ${n}`:void 0,g=d.raw(`${t} ${s?"all ":""}`),N=a?d` offset ${a}`:void 0;return d`${u}${g}${l}${c}${h}${N}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:i,withList:n,select:o,overridingSystemValue_:a}){let u=[],l=e[b.Symbol.Columns],c=Object.entries(l).filter(([L,z])=>!z.shouldDisableInsert()),h=c.map(([,L])=>d.identifier(this.casing.getColumnCasing(L)));if(o){let L=t;m(L,w)?u.push(L):u.push(L.getSQL())}else{let L=t;u.push(d.raw("values "));for(let[z,J]of L.entries()){let B=[];for(let[ce,G]of c){let A=J[ce];if(A===void 0||m(A,fe)&&A.value===void 0)if(G.defaultFn!==void 0){let $=G.defaultFn(),H=m($,w)?$:d.param($,G);B.push(H)}else if(!G.default&&G.onUpdateFn!==void 0){let $=G.onUpdateFn(),H=m($,w)?$:d.param($,G);B.push(H)}else B.push(d`default`);else B.push(A)}u.push(B),z<L.length-1&&u.push(d`, `)}}let g=this.buildWithCTE(n),N=d.join(u),k=i?d` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,T=s?d` on conflict ${s}`:void 0,I=a===!0?d`overriding system value `:void 0;return d`${g}insert into ${e} ${h} ${I}${N}${T}${k}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:s}){let i=t?d` concurrently`:void 0,n=s?d` with no data`:void 0;return d`refresh materialized view${i} ${e}${n}`}prepareTyping(e){return m(e,gr)||m(e,pr)?"json":m(e,yr)?"decimal":m(e,br)?"time":m(e,vr)||m(e,wr)?"timestamp":m(e,hr)||m(e,mr)?"date":m(e,xr)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:i,tableConfig:n,queryConfig:o,tableAlias:a,nestedQueryRelation:u,joinOn:l}){let c=[],h,g,N=[],k,T=[];if(o===!0)c=Object.entries(n.columns).map(([z,J])=>({dbKey:J.name,tsKey:z,field:Oe(J,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let L=Object.fromEntries(Object.entries(n.columns).map(([A,$])=>[A,Oe($,a)]));if(o.where){let A=typeof o.where=="function"?o.where(L,Ra()):o.where;k=A&&cr(A,a)}let z=[],J=[];if(o.columns){let A=!1;for(let[$,H]of Object.entries(o.columns))H!==void 0&&$ in n.columns&&(!A&&H===!0&&(A=!0),J.push($));J.length>0&&(J=A?J.filter($=>o.columns?.[$]===!0):Object.keys(n.columns).filter($=>!J.includes($)))}else J=Object.keys(n.columns);for(let A of J){let $=n.columns[A];z.push({tsKey:A,value:$})}let B=[];o.with&&(B=Object.entries(o.with).filter(A=>!!A[1]).map(([A,$])=>({tsKey:A,queryConfig:$,relation:n.relations[A]})));let ce;if(o.extras){ce=typeof o.extras=="function"?o.extras(L,{sql:d}):o.extras;for(let[A,$]of Object.entries(ce))z.push({tsKey:A,value:oi($,a)})}for(let{tsKey:A,value:$}of z)c.push({dbKey:m($,w.Aliased)?$.fieldAlias:n.columns[A].name,tsKey:A,field:m($,q)?Oe($,a):$,relationTableTsKey:void 0,isJson:!1,selection:[]});let G=typeof o.orderBy=="function"?o.orderBy(L,Ma()):o.orderBy??[];Array.isArray(G)||(G=[G]),N=G.map(A=>m(A,q)?Oe(A,a):cr(A,a)),h=o.limit,g=o.offset;for(let{tsKey:A,queryConfig:$,relation:H}of B){let Ot=Fa(t,s,H),Vs=nt(H.referencedTable),At=s[Vs],Je=`${a}_${A}`,ge=at(...Ot.fields.map((Lc,jc)=>$e(Oe(Ot.references[jc],Je),Oe(Lc,a)))),qe=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:e[At],tableConfig:t[At],queryConfig:m(H,He)?$===!0?{limit:1}:{...$,limit:1}:$,tableAlias:Je,joinOn:ge,nestedQueryRelation:H}),zs=d`${d.identifier(Je)}.${d.identifier("data")}`.as(A);T.push({on:d`true`,table:new W(qe.sql,{},Je),alias:Je,joinType:"left",lateral:!0}),c.push({dbKey:A,tsKey:A,field:zs,relationTableTsKey:At,isJson:!0,selection:qe.selection})}}if(c.length===0)throw new dr({message:`No fields selected for table "${n.tsName}" ("${a}")`});let I;if(k=at(l,k),u){let L=d`json_build_array(${d.join(c.map(({field:B,tsKey:ce,isJson:G})=>G?d`${d.identifier(`${a}_${ce}`)}.${d.identifier("data")}`:m(B,w.Aliased)?B.sql:B),d`, `)})`;m(u,Sr)&&(L=d`coalesce(json_agg(${L}${N.length>0?d` order by ${d.join(N,d`, `)}`:void 0}), '[]'::json)`);let z=[{dbKey:"data",tsKey:"data",field:L.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:c}];h!==void 0||g!==void 0||N.length>0?(I=this.buildSelectQuery({table:lr(i,a),fields:{},fieldsFlat:[{path:[],field:d.raw("*")}],where:k,limit:h,offset:g,orderBy:N,setOperators:[]}),k=void 0,h=void 0,g=void 0,N=[]):I=lr(i,a),I=this.buildSelectQuery({table:m(I,X)?I:new W(I,{},a),fields:{},fieldsFlat:z.map(({field:B})=>({path:[],field:m(B,q)?Oe(B,a):B})),joins:T,where:k,limit:h,offset:g,orderBy:N,setOperators:[]})}else I=this.buildSelectQuery({table:lr(i,a),fields:{},fieldsFlat:c.map(({field:L})=>({path:[],field:m(L,q)?Oe(L,a):L})),joins:T,where:k,limit:h,offset:g,orderBy:N,setOperators:[]});return{tableTsKey:n.tsName,sql:I,selection:c}}};var ns=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var se=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,s=e,i;return this.fields?i=this.fields:m(s,W)?i=Object.fromEntries(Object.keys(s._.selectedFields).map(n=>[n,s[n]])):m(s,jt)?i=s[M].selectedFields:m(s,w)?i={}:i=Hr(s),new os({table:s,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kn=class extends ns{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:s,session:i,dialect:n,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=s,this.session=i,this.dialect=n,this._={selectedFields:t},this.tableName=Me(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,s)=>{let i=this.tableName,n=Me(t);if(typeof n=="string"&&this.config.joins?.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof n=="string"&&!m(t,w))){let o=m(t,W)?t._.selectedFields:m(t,ne)?t[M].selectedFields:t[b.Symbol.Columns];this.config.fields[n]=o}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:t,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!0;break}case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return s=>{let i=typeof s=="function"?s(Jc()):s;if(!ur(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new W(this.getSQL(),this.config.fields,e),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new U({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},os=class extends kn{static[f]="PgSelect";_prepare(e){let{session:t,config:s,dialect:i,joinsNotNullableMap:n,authToken:o}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return K.startActiveSpan("drizzle.prepareQuery",()=>{let a=ve(s.fields),u=t.prepareQuery(i.sqlToQuery(this.getSQL()),a,e,!0);return u.joinsNotNullableMap=n,u.setToken(o)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>K.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};Ro(os,[re]);function Dt(r,e){return(t,s,...i)=>{let n=[s,...i].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of n)if(!ur(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(n)}}var Jc=()=>({union:Hc,unionAll:Xc,intersect:Yc,intersectAll:eu,except:tu,exceptAll:ru}),Hc=Dt("union",!1),Xc=Dt("union",!0),Yc=Dt("intersect",!1),eu=Dt("intersect",!0),tu=Dt("except",!1),ru=Dt("except",!0);var qt=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=m(e,Xe)?e:void 0,this.dialectConfig=m(e,Xe)?void 0:e}$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(s)),new Proxy(new $t(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function s(o){return new se({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(o){return new se({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function n(o,a){return new se({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:s,selectDistinct:i,selectDistinctOn:n}}select(e){return new se({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new se({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new se({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xe(this.dialectConfig)),this.dialect}};var Tr=class{constructor(e,t,s,i,n){this.table=e,this.session=t,this.dialect=s,this.withList=i,this.overridingSystemValue_=n}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(s=>{let i={},n=this.table[b.Symbol.Columns];for(let o of Object.keys(s)){let a=s[o];i[o]=m(a,w)?a:new fe(a,n[o])}return i});return new as(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new qt):e;if(!m(t,w)&&!ur(this.table[Zr],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new as(this.table,t,this.session,this.dialect,this.withList,!0)}},as=class extends re{constructor(e,t,s,i,n,o,a){super(),this.session=s,this.dialect=i,this.config={table:e,values:t,withList:n,select:o,overridingSystemValue_:a}}static[f]="PgInsert";config;returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ve(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=d`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let s=e.where?d` where ${e.where}`:void 0;this.config.onConflict=d`(${d.raw(t)})${s} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?d` where ${e.where}`:void 0,s=e.targetWhere?d` where ${e.targetWhere}`:void 0,i=e.setWhere?d` where ${e.setWhere}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,Jr(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=d`(${d.raw(o)})${s} do update set ${n}${t}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return K.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>K.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ue(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ls=class extends re{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return K.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>K.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var Nr=class{constructor(e,t,s,i){this.table=e,this.session=t,this.dialect=s,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Pn(this.table,Jr(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Pn=class extends re{constructor(e,t,s,i,n){super(),this.session=s,this.dialect=i,this.config={set:t,table:e,withList:n,joins:[]},this.tableName=Me(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let t=e,s=Me(t);return typeof s=="string"&&(this.joinsNotNullableMap[s]=!0),this.config.from=t,this}getTableLikeFields(e){return m(e,X)?e[b.Symbol.Columns]:m(e,W)?e._.selectedFields:e[M].selectedFields}createJoin(e){return(t,s)=>{let i=Me(t);if(typeof i=="string"&&this.config.joins.some(n=>n.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof s=="function"){let n=this.config.from&&!m(this.config.from,w)?this.getTableLikeFields(this.config.from):void 0;s=s(new Proxy(this.config.table[b.Symbol.Columns],new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),n&&new Proxy(n,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:s,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([n])=>[n,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([n])=>[n,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[b.Symbol.Columns]),this.config.from)){let t=Me(this.config.from);if(typeof t=="string"&&this.config.from&&!m(this.config.from,w)){let s=this.getTableLikeFields(this.config.from);e[t]=s}for(let s of this.config.joins){let i=Me(s.table);if(typeof i=="string"&&!m(s.table,w)){let n=this.getTableLikeFields(s.table);e[i]=n}}}return this.config.returningFields=e,this.config.returning=ve(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ue(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var cs=class r extends w{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return d`(select count(*) from ${e}${d.raw(" where ").if(t)}${t})`}static buildCount(e,t){return d`select count(*) as count from ${e}${d.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var us=class{constructor(e,t,s,i,n,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=i,this.tableConfig=n,this.dialect=o,this.session=a}static[f]="PgRelationalQueryBuilder";findMany(e){return new fs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new fs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},fs=class extends re{constructor(e,t,s,i,n,o,a,u,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=i,this.tableConfig=n,this.dialect=o,this.session=a,this.config=u,this.mode=l}static[f]="PgRelationalQuery";_prepare(e){return K.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,e,!0,(i,n)=>{let o=i.map(a=>is(this.schema,this.tableConfig,a,t.selection,n));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return K.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var ds=class extends re{constructor(e,t,s,i){super(),this.execute=e,this.sql=t,this.query=s,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Rt=class{constructor(e,t,s){if(this.dialect=e,this.session=t,this._=s?{schema:s.schema,fullSchema:s.fullSchema,tableNamesMap:s.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[i,n]of Object.entries(this._.schema))this.query[i]=new us(s.fullSchema,this._.schema,this._.tableNamesMap,s.fullSchema[i],n,e,t)}static[f]="PgDatabase";query;$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(new qt(s.dialect))),new Proxy(new $t(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new cs({source:e,filters:t,session:this.session})}with(...e){let t=this;function s(l){return new se({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(l){return new se({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function n(l,c){return new se({fields:c??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:l}})}function o(l){return new Nr(l,t.session,t.dialect,e)}function a(l){return new Tr(l,t.session,t.dialect,e)}function u(l){return new fr(l,t.session,t.dialect,e)}return{select:s,selectDistinct:i,selectDistinctOn:n,update:o,insert:a,delete:u}}select(e){return new se({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new se({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new se({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Nr(e,this.session,this.dialect)}insert(e){return new Tr(e,this.session,this.dialect)}delete(e){return new fr(e,this.session,this.dialect)}refreshMaterializedView(e){return new ls(e,this.session,this.dialect)}authToken;execute(e){let t=typeof e=="string"?d.raw(e):e.getSQL(),s=this.dialect.sqlToQuery(t),i=this.session.prepareQuery(s,void 0,void 0,!1);return new ds(()=>i.execute(void 0,this.authToken),t,s,n=>i.mapResult(n,!0))}transaction(e,t){return this.session.transaction(e,t)}};var me=require("@neondatabase/serverless");var hs=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ms=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,t){return K.startActiveSpan("drizzle.operation",()=>K.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let s=await this.execute(e,t);return Number(s[0].count)}},ps=class extends Rt{constructor(e,t,s,i=0){super(e,t,s),this.schema=s,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Yr}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),d.raw(t.join(" "))}setTransaction(e){return this.session.execute(d`set transaction ${this.getTransactionConfigSQL(e)}`)}};var On=class extends hs{constructor(e,t,s,i,n,o,a,u){super({sql:t,params:s}),this.client=e,this.params=s,this.logger=i,this.fields=n,this._isResponseInArrayMode=a,this.customResultMapper=u,this.rawQueryConfig={name:o,text:t,types:{getTypeParser:(l,c)=>l===me.types.builtins.TIMESTAMPTZ?h=>h:l===me.types.builtins.TIMESTAMP?h=>h:l===me.types.builtins.DATE?h=>h:l===me.types.builtins.INTERVAL?h=>h:me.types.getTypeParser(l,c)}},this.queryConfig={name:o,text:t,rowMode:"array",types:{getTypeParser:(l,c)=>l===me.types.builtins.TIMESTAMPTZ?h=>h:l===me.types.builtins.TIMESTAMP?h=>h:l===me.types.builtins.DATE?h=>h:l===me.types.builtins.INTERVAL?h=>h:me.types.getTypeParser(l,c)}}}static[f]="NeonPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){let t=Gr(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:s,client:i,rawQueryConfig:n,queryConfig:o,joinsNotNullableMap:a,customResultMapper:u}=this;if(!s&&!u)return i.query(n,t);let l=await i.query(o,t);return u?u(l.rows):l.rows.map(c=>qo(s,c,a))}all(e={}){let t=Gr(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),this.client.query(this.rawQueryConfig,t).then(s=>s.rows)}values(e={}){let t=Gr(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),this.client.query(this.queryConfig,t).then(s=>s.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}},gs=class r extends ms{constructor(e,t,s,i={}){super(t),this.client=e,this.schema=s,this.options=i,this.logger=i.logger??new zr}static[f]="NeonSession";logger;prepareQuery(e,t,s,i,n){return new On(this.client,e.sql,e.params,this.logger,t,s,i,n)}async query(e,t){return this.logger.logQuery(e,t),await this.client.query({rowMode:"array",text:e,values:t})}async queryObjects(e,t){return this.client.query(e,t)}async count(e){let t=await this.execute(e);return Number(t.rows[0].count)}async transaction(e,t={}){let s=this.client instanceof me.Pool?new r(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new An(this.dialect,s,this.schema);await i.execute(d`begin ${i.getTransactionConfigSQL(t)}`);try{let n=await e(i);return await i.execute(d`commit`),n}catch(n){throw await i.execute(d`rollback`),n}finally{this.client instanceof me.Pool&&s.client.release()}}},An=class r extends ps{static[f]="NeonTransaction";async transaction(e){let t=`sp${this.nestedIndex+1}`,s=new r(this.dialect,this.session,this.schema,this.nestedIndex+1);await s.execute(d.raw(`savepoint ${t}`));try{let i=await e(s);return await s.execute(d.raw(`release savepoint ${t}`)),i}catch(i){throw await s.execute(d.raw(`rollback to savepoint ${t}`)),i}}};var $n=class{constructor(e,t,s={}){this.client=e,this.dialect=t,this.options=s}static[f]="NeonDriver";createSession(e){return new gs(this.client,this.dialect,e,{logger:this.options.logger})}},In=class extends Rt{static[f]="NeonServerlessDatabase"};function Cr(r,e={}){let t=new Xe({casing:e.casing}),s;e.logger===!0?s=new Vr:e.logger!==!1&&(s=e.logger);let i;if(e.schema){let u=Ba(e.schema,Va);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let o=new $n(r,t,{logger:s}).createSession(i),a=new In(t,o,i);return a.$client=r,a}function ys(...r){if(typeof r[0]=="string"){let e=new Mt.Pool({connectionString:r[0]});return Cr(e,r[1])}if(Bo(r[0])){let{connection:e,client:t,ws:s,...i}=r[0];if(s&&(Mt.neonConfig.webSocketConstructor=s),t)return Cr(t,i);let n=typeof e=="string"?new Mt.Pool({connectionString:e}):new Mt.Pool(e);return Cr(n,i)}return Cr(r[0],r[1])}(r=>{function e(t){return Cr({},t)}r.mock=e})(ys||(ys={}));var Of=nr(sc(),1),Af=nr(Xn(),1),$f=nr(to(),1),hc=nr(Ps(),1),If=nr(dc(),1);var mc=hc.default;var go={};Bc(go,{activityLogs:()=>qs,insertActivityLogSchema:()=>Hd,insertIssueSchema:()=>Jd,issues:()=>le});var D;(function(r){r.assertEqual=i=>i;function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{let n={};for(let o of i)n[o]=o;return n},r.getValidEnumValues=i=>{let n=r.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(let a of n)o[a]=i[a];return r.objectValues(o)},r.objectValues=i=>r.objectKeys(i).map(function(n){return i[n]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let n=[];for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&n.push(o);return n},r.find=(i,n)=>{for(let o of i)if(n(o))return o},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function s(i,n=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}r.joinValues=s,r.jsonStringifyReplacer=(i,n)=>typeof n=="bigint"?n.toString():n})(D||(D={}));var uo;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(uo||(uo={}));var v=D.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ke=r=>{switch(typeof r){case"undefined":return v.undefined;case"string":return v.string;case"number":return isNaN(r)?v.nan:v.number;case"boolean":return v.boolean;case"function":return v.function;case"bigint":return v.bigint;case"symbol":return v.symbol;case"object":return Array.isArray(r)?v.array:r===null?v.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?v.promise:typeof Map<"u"&&r instanceof Map?v.map:typeof Set<"u"&&r instanceof Set?v.set:typeof Date<"u"&&r instanceof Date?v.date:v.object;default:return v.unknown}},p=D.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Lf=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),_e=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(n){return n.message},s={_errors:[]},i=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,u=0;for(;u<o.path.length;){let l=o.path[u];u===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],u++}}};return i(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,D.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):s.push(e(i));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};_e.create=r=>new _e(r);var Gt=(r,e)=>{let t;switch(r.code){case p.invalid_type:r.received===v.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,D.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${D.joinValues(r.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${D.joinValues(r.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${D.joinValues(r.options)}, received '${r.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:D.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case p.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case p.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,D.assertNever(r)}return{message:t}},_c=Gt;function jf(r){_c=r}function As(){return _c}var $s=r=>{let{data:e,path:t,errorMaps:s,issueData:i}=r,n=[...t,...i.path||[]],o={...i,path:n};if(i.message!==void 0)return{...i,path:n,message:i.message};let a="",u=s.filter(l=>!!l).slice().reverse();for(let l of u)a=l(o,{data:e,defaultError:a}).message;return{...i,path:n,message:a}},Df=[];function _(r,e){let t=As(),s=$s({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Gt?void 0:Gt].filter(i=>!!i)});r.common.issues.push(s)}var ie=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let i of t){if(i.status==="aborted")return E;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let i of t){let n=await i.key,o=await i.value;s.push({key:n,value:o})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let i of t){let{key:n,value:o}=i;if(n.status==="aborted"||o.status==="aborted")return E;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(s[n.value]=o.value)}return{status:e.value,value:s}}},E=Object.freeze({status:"aborted"}),Zt=r=>({status:"dirty",value:r}),oe=r=>({status:"valid",value:r}),fo=r=>r.status==="aborted",ho=r=>r.status==="dirty",ht=r=>r.status==="valid",qr=r=>typeof Promise<"u"&&r instanceof Promise;function Is(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}function bc(r,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t}var S;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(S||(S={}));var jr,Dr,Te=class{constructor(e,t,s,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},pc=(r,e)=>{if(ht(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new _e(r.common.issues);return this._error=t,this._error}}};function P(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:i}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{var u,l;let{message:c}=r;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:(u=c??s)!==null&&u!==void 0?u:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(l=c??t)!==null&&l!==void 0?l:a.defaultError}},description:i}}var O=class{get description(){return this._def.description}_getType(e){return Ke(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ke(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ie,ctx:{common:e.parent.common,data:e.data,parsedType:Ke(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(qr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;let i={common:{issues:[],async:(s=t?.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)},n=this._parseSync({data:e,path:i.path,parent:i});return pc(i,n)}"~validate"(e){var t,s;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:i});return ht(n)?{value:n.value}:{issues:i.common.issues}}catch(n){!((s=(t=n?.message)===null||t===void 0?void 0:t.toLowerCase())===null||s===void 0)&&s.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(n=>ht(n)?{value:n.value}:{issues:i.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)},i=this._parse({data:e,path:s.path,parent:s}),n=await(qr(i)?i:Promise.resolve(i));return pc(s,n)}refine(e,t){let s=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,n)=>{let o=e(i),a=()=>n.addIssue({code:p.custom,...s(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof t=="function"?t(s,i):t),!1))}_refinement(e){return new be({schema:this,typeName:C.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Se.create(this,this._def)}nullable(){return De.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ge.create(this)}promise(){return st.create(this,this._def)}or(e){return vt.create([this,e],this._def)}and(e){return wt.create(this,e,this._def)}transform(e){return new be({...P(this._def),schema:this,typeName:C.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Ct({...P(this._def),innerType:this,defaultValue:t,typeName:C.ZodDefault})}brand(){return new Rr({typeName:C.ZodBranded,type:this,...P(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Et({...P(this._def),innerType:this,catchValue:t,typeName:C.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Mr.create(this,e)}readonly(){return kt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},qf=/^c[^\s-]{8,}$/i,Rf=/^[0-9a-z]+$/,Mf=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Bf=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ff=/^[a-z0-9_-]{21}$/i,Vf=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,zf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Uf=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Qf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",co,Wf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Kf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Zf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Gf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Jf=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Hf=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,vc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Xf=new RegExp(`^${vc}$`);function wc(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Yf(r){return new RegExp(`^${wc(r)}$`)}function xc(r){let e=`${vc}T${wc(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function ed(r,e){return!!((e==="v4"||!e)&&Wf.test(r)||(e==="v6"||!e)&&Zf.test(r))}function td(r,e){if(!Vf.test(r))return!1;try{let[t]=r.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function rd(r,e){return!!((e==="v4"||!e)&&Kf.test(r)||(e==="v6"||!e)&&Gf.test(r))}var tt=class r extends O{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==v.string){let n=this._getOrReturnCtx(e);return _(n,{code:p.invalid_type,expected:v.string,received:n.parsedType}),E}let s=new ie,i;for(let n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(i=this._getOrReturnCtx(e,i),_(i,{code:p.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),s.dirty());else if(n.kind==="max")e.data.length>n.value&&(i=this._getOrReturnCtx(e,i),_(i,{code:p.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),s.dirty());else if(n.kind==="length"){let o=e.data.length>n.value,a=e.data.length<n.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?_(i,{code:p.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&_(i,{code:p.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),s.dirty())}else if(n.kind==="email")Uf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"email",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="emoji")co||(co=new RegExp(Qf,"u")),co.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"emoji",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="uuid")Bf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"uuid",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="nanoid")Ff.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"nanoid",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="cuid")qf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"cuid",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="cuid2")Rf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"cuid2",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="ulid")Mf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"ulid",code:p.invalid_string,message:n.message}),s.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),_(i,{validation:"url",code:p.invalid_string,message:n.message}),s.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"regex",code:p.invalid_string,message:n.message}),s.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),s.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:{startsWith:n.value},message:n.message}),s.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:{endsWith:n.value},message:n.message}),s.dirty()):n.kind==="datetime"?xc(n).test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:"datetime",message:n.message}),s.dirty()):n.kind==="date"?Xf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:"date",message:n.message}),s.dirty()):n.kind==="time"?Yf(n).test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{code:p.invalid_string,validation:"time",message:n.message}),s.dirty()):n.kind==="duration"?zf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"duration",code:p.invalid_string,message:n.message}),s.dirty()):n.kind==="ip"?ed(e.data,n.version)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"ip",code:p.invalid_string,message:n.message}),s.dirty()):n.kind==="jwt"?td(e.data,n.alg)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"jwt",code:p.invalid_string,message:n.message}),s.dirty()):n.kind==="cidr"?rd(e.data,n.version)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"cidr",code:p.invalid_string,message:n.message}),s.dirty()):n.kind==="base64"?Jf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"base64",code:p.invalid_string,message:n.message}),s.dirty()):n.kind==="base64url"?Hf.test(e.data)||(i=this._getOrReturnCtx(e,i),_(i,{validation:"base64url",code:p.invalid_string,message:n.message}),s.dirty()):D.assertNever(n);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(i=>e.test(i),{validation:t,code:p.invalid_string,...S.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...S.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...S.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(s=e?.local)!==null&&s!==void 0?s:!1,...S.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...S.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...S.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};tt.create=r=>{var e;return new tt({checks:[],typeName:C.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...P(r)})};function sd(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=t>s?t:s,n=parseInt(r.toFixed(i).replace(".","")),o=parseInt(e.toFixed(i).replace(".",""));return n%o/Math.pow(10,i)}var mt=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==v.number){let n=this._getOrReturnCtx(e);return _(n,{code:p.invalid_type,expected:v.number,received:n.parsedType}),E}let s,i=new ie;for(let n of this._def.checks)n.kind==="int"?D.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),_(s,{code:p.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="multipleOf"?sd(e.data,n.value)!==0&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),_(s,{code:p.not_finite,message:n.message}),i.dirty()):D.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&D.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};mt.create=r=>new mt({checks:[],typeName:C.ZodNumber,coerce:r?.coerce||!1,...P(r)});var pt=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==v.bigint)return this._getInvalidInput(e);let s,i=new ie;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),_(s,{code:p.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):D.assertNever(n);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return _(t,{code:p.invalid_type,expected:v.bigint,received:t.parsedType}),E}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};pt.create=r=>{var e;return new pt({checks:[],typeName:C.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...P(r)})};var gt=class extends O{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==v.boolean){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.boolean,received:s.parsedType}),E}return oe(e.data)}};gt.create=r=>new gt({typeName:C.ZodBoolean,coerce:r?.coerce||!1,...P(r)});var yt=class r extends O{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==v.date){let n=this._getOrReturnCtx(e);return _(n,{code:p.invalid_type,expected:v.date,received:n.parsedType}),E}if(isNaN(e.data.getTime())){let n=this._getOrReturnCtx(e);return _(n,{code:p.invalid_date}),E}let s=new ie,i;for(let n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(i=this._getOrReturnCtx(e,i),_(i,{code:p.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),s.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(i=this._getOrReturnCtx(e,i),_(i,{code:p.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),s.dirty()):D.assertNever(n);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};yt.create=r=>new yt({checks:[],coerce:r?.coerce||!1,typeName:C.ZodDate,...P(r)});var Jt=class extends O{_parse(e){if(this._getType(e)!==v.symbol){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.symbol,received:s.parsedType}),E}return oe(e.data)}};Jt.create=r=>new Jt({typeName:C.ZodSymbol,...P(r)});var _t=class extends O{_parse(e){if(this._getType(e)!==v.undefined){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.undefined,received:s.parsedType}),E}return oe(e.data)}};_t.create=r=>new _t({typeName:C.ZodUndefined,...P(r)});var bt=class extends O{_parse(e){if(this._getType(e)!==v.null){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.null,received:s.parsedType}),E}return oe(e.data)}};bt.create=r=>new bt({typeName:C.ZodNull,...P(r)});var rt=class extends O{constructor(){super(...arguments),this._any=!0}_parse(e){return oe(e.data)}};rt.create=r=>new rt({typeName:C.ZodAny,...P(r)});var Ze=class extends O{constructor(){super(...arguments),this._unknown=!0}_parse(e){return oe(e.data)}};Ze.create=r=>new Ze({typeName:C.ZodUnknown,...P(r)});var Pe=class extends O{_parse(e){let t=this._getOrReturnCtx(e);return _(t,{code:p.invalid_type,expected:v.never,received:t.parsedType}),E}};Pe.create=r=>new Pe({typeName:C.ZodNever,...P(r)});var Ht=class extends O{_parse(e){if(this._getType(e)!==v.undefined){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.void,received:s.parsedType}),E}return oe(e.data)}};Ht.create=r=>new Ht({typeName:C.ZodVoid,...P(r)});var Ge=class r extends O{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),i=this._def;if(t.parsedType!==v.array)return _(t,{code:p.invalid_type,expected:v.array,received:t.parsedType}),E;if(i.exactLength!==null){let o=t.data.length>i.exactLength.value,a=t.data.length<i.exactLength.value;(o||a)&&(_(t,{code:o?p.too_big:p.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(_(t,{code:p.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(_(t,{code:p.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>i.type._parseAsync(new Te(t,o,t.path,a)))).then(o=>ie.mergeArray(s,o));let n=[...t.data].map((o,a)=>i.type._parseSync(new Te(t,o,t.path,a)));return ie.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}};Ge.create=(r,e)=>new Ge({type:r,minLength:null,maxLength:null,exactLength:null,typeName:C.ZodArray,...P(e)});function Kt(r){if(r instanceof pe){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=Se.create(Kt(s))}return new pe({...r._def,shape:()=>e})}else return r instanceof Ge?new Ge({...r._def,type:Kt(r.element)}):r instanceof Se?Se.create(Kt(r.unwrap())):r instanceof De?De.create(Kt(r.unwrap())):r instanceof je?je.create(r.items.map(e=>Kt(e))):r}var pe=class r extends O{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=D.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==v.object){let l=this._getOrReturnCtx(e);return _(l,{code:p.invalid_type,expected:v.object,received:l.parsedType}),E}let{status:s,ctx:i}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Pe&&this._def.unknownKeys==="strip"))for(let l in i.data)o.includes(l)||a.push(l);let u=[];for(let l of o){let c=n[l],h=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Te(i,h,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof Pe){let l=this._def.unknownKeys;if(l==="passthrough")for(let c of a)u.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(l==="strict")a.length>0&&(_(i,{code:p.unrecognized_keys,keys:a}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let c of a){let h=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Te(i,h,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let l=[];for(let c of u){let h=await c.key,g=await c.value;l.push({key:h,value:g,alwaysSet:c.alwaysSet})}return l}).then(l=>ie.mergeObjectSync(s,l)):ie.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var i,n,o,a;let u=(o=(n=(i=this._def).errorMap)===null||n===void 0?void 0:n.call(i,t,s).message)!==null&&o!==void 0?o:s.defaultError;return t.code==="unrecognized_keys"?{message:(a=S.errToObj(e).message)!==null&&a!==void 0?a:u}:{message:u}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:C.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return D.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return D.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new r({...this._def,shape:()=>t})}deepPartial(){return Kt(this)}partial(e){let t={};return D.objectKeys(this.shape).forEach(s=>{let i=this.shape[s];e&&!e[s]?t[s]=i:t[s]=i.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return D.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let n=this.shape[s];for(;n instanceof Se;)n=n._def.innerType;t[s]=n}}),new r({...this._def,shape:()=>t})}keyof(){return Sc(D.objectKeys(this.shape))}};pe.create=(r,e)=>new pe({shape:()=>r,unknownKeys:"strip",catchall:Pe.create(),typeName:C.ZodObject,...P(e)});pe.strictCreate=(r,e)=>new pe({shape:()=>r,unknownKeys:"strict",catchall:Pe.create(),typeName:C.ZodObject,...P(e)});pe.lazycreate=(r,e)=>new pe({shape:r,unknownKeys:"strip",catchall:Pe.create(),typeName:C.ZodObject,...P(e)});var vt=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function i(n){for(let a of n)if(a.result.status==="valid")return a.result;for(let a of n)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=n.map(a=>new _e(a.ctx.common.issues));return _(t,{code:p.invalid_union,unionErrors:o}),E}if(t.common.async)return Promise.all(s.map(async n=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await n._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(i);{let n,o=[];for(let u of s){let l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!n&&(n={result:c,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(n)return t.common.issues.push(...n.ctx.common.issues),n.result;let a=o.map(u=>new _e(u));return _(t,{code:p.invalid_union,unionErrors:a}),E}}get options(){return this._def.options}};vt.create=(r,e)=>new vt({options:r,typeName:C.ZodUnion,...P(e)});var We=r=>r instanceof xt?We(r.schema):r instanceof be?We(r.innerType()):r instanceof St?[r.value]:r instanceof Tt?r.options:r instanceof Nt?D.objectValues(r.enum):r instanceof Ct?We(r._def.innerType):r instanceof _t?[void 0]:r instanceof bt?[null]:r instanceof Se?[void 0,...We(r.unwrap())]:r instanceof De?[null,...We(r.unwrap())]:r instanceof Rr||r instanceof kt?We(r.unwrap()):r instanceof Et?We(r._def.innerType):[],Ls=class r extends O{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.object)return _(t,{code:p.invalid_type,expected:v.object,received:t.parsedType}),E;let s=this.discriminator,i=t.data[s],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(_(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),E)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let i=new Map;for(let n of t){let o=We(n.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,n)}}return new r({typeName:C.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...P(s)})}};function mo(r,e){let t=Ke(r),s=Ke(e);if(r===e)return{valid:!0,data:r};if(t===v.object&&s===v.object){let i=D.objectKeys(e),n=D.objectKeys(r).filter(a=>i.indexOf(a)!==-1),o={...r,...e};for(let a of n){let u=mo(r[a],e[a]);if(!u.valid)return{valid:!1};o[a]=u.data}return{valid:!0,data:o}}else if(t===v.array&&s===v.array){if(r.length!==e.length)return{valid:!1};let i=[];for(let n=0;n<r.length;n++){let o=r[n],a=e[n],u=mo(o,a);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===v.date&&s===v.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var wt=class extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),i=(n,o)=>{if(fo(n)||fo(o))return E;let a=mo(n.value,o.value);return a.valid?((ho(n)||ho(o))&&t.dirty(),{status:t.value,value:a.data}):(_(s,{code:p.invalid_intersection_types}),E)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([n,o])=>i(n,o)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};wt.create=(r,e,t)=>new wt({left:r,right:e,typeName:C.ZodIntersection,...P(t)});var je=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.array)return _(s,{code:p.invalid_type,expected:v.array,received:s.parsedType}),E;if(s.data.length<this._def.items.length)return _(s,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),E;!this._def.rest&&s.data.length>this._def.items.length&&(_(s,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...s.data].map((o,a)=>{let u=this._def.items[a]||this._def.rest;return u?u._parse(new Te(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(n).then(o=>ie.mergeArray(t,o)):ie.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};je.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new je({items:r,typeName:C.ZodTuple,rest:null,...P(e)})};var js=class r extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.object)return _(s,{code:p.invalid_type,expected:v.object,received:s.parsedType}),E;let i=[],n=this._def.keyType,o=this._def.valueType;for(let a in s.data)i.push({key:n._parse(new Te(s,a,s.path,a)),value:o._parse(new Te(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?ie.mergeObjectAsync(t,i):ie.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof O?new r({keyType:e,valueType:t,typeName:C.ZodRecord,...P(s)}):new r({keyType:tt.create(),valueType:e,typeName:C.ZodRecord,...P(t)})}},Xt=class extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.map)return _(s,{code:p.invalid_type,expected:v.map,received:s.parsedType}),E;let i=this._def.keyType,n=this._def.valueType,o=[...s.data.entries()].map(([a,u],l)=>({key:i._parse(new Te(s,a,s.path,[l,"key"])),value:n._parse(new Te(s,u,s.path,[l,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let u of o){let l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return E;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),a.set(l.value,c.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let u of o){let l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return E;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),a.set(l.value,c.value)}return{status:t.value,value:a}}}};Xt.create=(r,e,t)=>new Xt({valueType:e,keyType:r,typeName:C.ZodMap,...P(t)});var Yt=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.set)return _(s,{code:p.invalid_type,expected:v.set,received:s.parsedType}),E;let i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(_(s,{code:p.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(_(s,{code:p.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function o(u){let l=new Set;for(let c of u){if(c.status==="aborted")return E;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}let a=[...s.data.values()].map((u,l)=>n._parse(new Te(s,u,s.path,l)));return s.common.async?Promise.all(a).then(u=>o(u)):o(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Yt.create=(r,e)=>new Yt({valueType:r,minSize:null,maxSize:null,typeName:C.ZodSet,...P(e)});var Ds=class r extends O{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.function)return _(t,{code:p.invalid_type,expected:v.function,received:t.parsedType}),E;function s(a,u){return $s({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,As(),Gt].filter(l=>!!l),issueData:{code:p.invalid_arguments,argumentsError:u}})}function i(a,u){return $s({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,As(),Gt].filter(l=>!!l),issueData:{code:p.invalid_return_type,returnTypeError:u}})}let n={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof st){let a=this;return oe(async function(...u){let l=new _e([]),c=await a._def.args.parseAsync(u,n).catch(N=>{throw l.addIssue(s(u,N)),l}),h=await Reflect.apply(o,this,c);return await a._def.returns._def.type.parseAsync(h,n).catch(N=>{throw l.addIssue(i(h,N)),l})})}else{let a=this;return oe(function(...u){let l=a._def.args.safeParse(u,n);if(!l.success)throw new _e([s(u,l.error)]);let c=Reflect.apply(o,this,l.data),h=a._def.returns.safeParse(c,n);if(!h.success)throw new _e([i(c,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:je.create(e).rest(Ze.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||je.create([]).rest(Ze.create()),returns:t||Ze.create(),typeName:C.ZodFunction,...P(s)})}},xt=class extends O{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};xt.create=(r,e)=>new xt({getter:r,typeName:C.ZodLazy,...P(e)});var St=class extends O{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return _(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),E}return{status:"valid",value:e.data}}get value(){return this._def.value}};St.create=(r,e)=>new St({value:r,typeName:C.ZodLiteral,...P(e)});function Sc(r,e){return new Tt({values:r,typeName:C.ZodEnum,...P(e)})}var Tt=class r extends O{constructor(){super(...arguments),jr.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return _(t,{expected:D.joinValues(s),received:t.parsedType,code:p.invalid_type}),E}if(Is(this,jr,"f")||bc(this,jr,new Set(this._def.values),"f"),!Is(this,jr,"f").has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return _(t,{received:t.data,code:p.invalid_enum_value,options:s}),E}return oe(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};jr=new WeakMap;Tt.create=Sc;var Nt=class extends O{constructor(){super(...arguments),Dr.set(this,void 0)}_parse(e){let t=D.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==v.string&&s.parsedType!==v.number){let i=D.objectValues(t);return _(s,{expected:D.joinValues(i),received:s.parsedType,code:p.invalid_type}),E}if(Is(this,Dr,"f")||bc(this,Dr,new Set(D.getValidEnumValues(this._def.values)),"f"),!Is(this,Dr,"f").has(e.data)){let i=D.objectValues(t);return _(s,{received:s.data,code:p.invalid_enum_value,options:i}),E}return oe(e.data)}get enum(){return this._def.values}};Dr=new WeakMap;Nt.create=(r,e)=>new Nt({values:r,typeName:C.ZodNativeEnum,...P(e)});var st=class extends O{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.promise&&t.common.async===!1)return _(t,{code:p.invalid_type,expected:v.promise,received:t.parsedType}),E;let s=t.parsedType===v.promise?t.data:Promise.resolve(t.data);return oe(s.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}};st.create=(r,e)=>new st({type:r,typeName:C.ZodPromise,...P(e)});var be=class extends O{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===C.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:o=>{_(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),i.type==="preprocess"){let o=i.transform(s.data,n);if(s.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return E;let u=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return u.status==="aborted"?E:u.status==="dirty"||t.value==="dirty"?Zt(u.value):u});{if(t.value==="aborted")return E;let a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?E:a.status==="dirty"||t.value==="dirty"?Zt(a.value):a}}if(i.type==="refinement"){let o=a=>{let u=i.refinement(a,n);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?E:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?E:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(i.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!ht(o))return o;let a=i.transform(o.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>ht(o)?Promise.resolve(i.transform(o.value,n)).then(a=>({status:t.value,value:a})):o);D.assertNever(i)}};be.create=(r,e,t)=>new be({schema:r,typeName:C.ZodEffects,effect:e,...P(t)});be.createWithPreprocess=(r,e,t)=>new be({schema:e,effect:{type:"preprocess",transform:r},typeName:C.ZodEffects,...P(t)});var Se=class extends O{_parse(e){return this._getType(e)===v.undefined?oe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Se.create=(r,e)=>new Se({innerType:r,typeName:C.ZodOptional,...P(e)});var De=class extends O{_parse(e){return this._getType(e)===v.null?oe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};De.create=(r,e)=>new De({innerType:r,typeName:C.ZodNullable,...P(e)});var Ct=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===v.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Ct.create=(r,e)=>new Ct({innerType:r,typeName:C.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...P(e)});var Et=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return qr(i)?i.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new _e(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new _e(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Et.create=(r,e)=>new Et({innerType:r,typeName:C.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...P(e)});var er=class extends O{_parse(e){if(this._getType(e)!==v.nan){let s=this._getOrReturnCtx(e);return _(s,{code:p.invalid_type,expected:v.nan,received:s.parsedType}),E}return{status:"valid",value:e.data}}};er.create=r=>new er({typeName:C.ZodNaN,...P(r)});var id=Symbol("zod_brand"),Rr=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},Mr=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let n=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?E:n.status==="dirty"?(t.dirty(),Zt(n.value)):this._def.out._parseAsync({data:n.value,path:s.path,parent:s})})();{let i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?E:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:C.ZodPipeline})}},kt=class extends O{_parse(e){let t=this._def.innerType._parse(e),s=i=>(ht(i)&&(i.value=Object.freeze(i.value)),i);return qr(t)?t.then(i=>s(i)):s(t)}unwrap(){return this._def.innerType}};kt.create=(r,e)=>new kt({innerType:r,typeName:C.ZodReadonly,...P(e)});function gc(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Tc(r,e={},t){return r?rt.create().superRefine((s,i)=>{var n,o;let a=r(s);if(a instanceof Promise)return a.then(u=>{var l,c;if(!u){let h=gc(e,s),g=(c=(l=h.fatal)!==null&&l!==void 0?l:t)!==null&&c!==void 0?c:!0;i.addIssue({code:"custom",...h,fatal:g})}});if(!a){let u=gc(e,s),l=(o=(n=u.fatal)!==null&&n!==void 0?n:t)!==null&&o!==void 0?o:!0;i.addIssue({code:"custom",...u,fatal:l})}}):rt.create()}var nd={object:pe.lazycreate},C;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(C||(C={}));var od=(r,e={message:`Input not instance of ${r.name}`})=>Tc(t=>t instanceof r,e),Nc=tt.create,Cc=mt.create,ad=er.create,ld=pt.create,Ec=gt.create,cd=yt.create,ud=Jt.create,fd=_t.create,dd=bt.create,hd=rt.create,md=Ze.create,pd=Pe.create,gd=Ht.create,yd=Ge.create,_d=pe.create,bd=pe.strictCreate,vd=vt.create,wd=Ls.create,xd=wt.create,Sd=je.create,Td=js.create,Nd=Xt.create,Cd=Yt.create,Ed=Ds.create,kd=xt.create,Pd=St.create,Od=Tt.create,Ad=Nt.create,$d=st.create,yc=be.create,Id=Se.create,Ld=De.create,jd=be.createWithPreprocess,Dd=Mr.create,qd=()=>Nc().optional(),Rd=()=>Cc().optional(),Md=()=>Ec().optional(),Bd={string:(r=>tt.create({...r,coerce:!0})),number:(r=>mt.create({...r,coerce:!0})),boolean:(r=>gt.create({...r,coerce:!0})),bigint:(r=>pt.create({...r,coerce:!0})),date:(r=>yt.create({...r,coerce:!0}))},Fd=E,ae=Object.freeze({__proto__:null,defaultErrorMap:Gt,setErrorMap:jf,getErrorMap:As,makeIssue:$s,EMPTY_PATH:Df,addIssueToContext:_,ParseStatus:ie,INVALID:E,DIRTY:Zt,OK:oe,isAborted:fo,isDirty:ho,isValid:ht,isAsync:qr,get util(){return D},get objectUtil(){return uo},ZodParsedType:v,getParsedType:Ke,ZodType:O,datetimeRegex:xc,ZodString:tt,ZodNumber:mt,ZodBigInt:pt,ZodBoolean:gt,ZodDate:yt,ZodSymbol:Jt,ZodUndefined:_t,ZodNull:bt,ZodAny:rt,ZodUnknown:Ze,ZodNever:Pe,ZodVoid:Ht,ZodArray:Ge,ZodObject:pe,ZodUnion:vt,ZodDiscriminatedUnion:Ls,ZodIntersection:wt,ZodTuple:je,ZodRecord:js,ZodMap:Xt,ZodSet:Yt,ZodFunction:Ds,ZodLazy:xt,ZodLiteral:St,ZodEnum:Tt,ZodNativeEnum:Nt,ZodPromise:st,ZodEffects:be,ZodTransformer:be,ZodOptional:Se,ZodNullable:De,ZodDefault:Ct,ZodCatch:Et,ZodNaN:er,BRAND:id,ZodBranded:Rr,ZodPipeline:Mr,ZodReadonly:kt,custom:Tc,Schema:O,ZodSchema:O,late:nd,get ZodFirstPartyTypeKind(){return C},coerce:Bd,any:hd,array:yd,bigint:ld,boolean:Ec,date:cd,discriminatedUnion:wd,effect:yc,enum:Od,function:Ed,instanceof:od,intersection:xd,lazy:kd,literal:Pd,map:Nd,nan:ad,nativeEnum:Ad,never:pd,null:dd,nullable:Ld,number:Cc,object:_d,oboolean:Md,onumber:Rd,optional:Id,ostring:qd,pipeline:Dd,preprocess:jd,promise:$d,record:Td,set:Cd,strictObject:bd,string:Nc,symbol:ud,transformer:yc,tuple:Sd,undefined:fd,union:vd,unknown:md,void:gd,NEVER:Fd,ZodIssueCode:p,quotelessJson:Lf,ZodError:_e});var V={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Q(r,e){return e.includes(r.columnType)}function Vd(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}var zd=ae.union([ae.string(),ae.number(),ae.boolean(),ae.null()]),Ud=ae.union([zd,ae.record(ae.any()),ae.array(ae.any())]),Qd=ae.custom(r=>r instanceof Buffer);function kc(r,e){let t=e?.zodInstance??ae,s=e?.coerce??{},i;return Vd(r)&&(i=r.enumValues.length?t.enum(r.enumValues):t.string()),i||(Q(r,["PgGeometry","PgPointTuple"])?i=t.tuple([t.number(),t.number()]):Q(r,["PgGeometryObject","PgPointObject"])?i=t.object({x:t.number(),y:t.number()}):Q(r,["PgHalfVector","PgVector"])?(i=t.array(t.number()),i=r.dimensions?i.length(r.dimensions):i):Q(r,["PgLine"])?i=t.tuple([t.number(),t.number(),t.number()]):Q(r,["PgLineABC"])?i=t.object({a:t.number(),b:t.number(),c:t.number()}):Q(r,["PgArray"])?(i=t.array(kc(r.baseColumn,t)),i=r.size?i.length(r.size):i):r.dataType==="array"?i=t.array(t.any()):r.dataType==="number"?i=Wd(r,t,s):r.dataType==="bigint"?i=Kd(r,t,s):r.dataType==="boolean"?i=s===!0||s.boolean?t.coerce.boolean():t.boolean():r.dataType==="date"?i=s===!0||s.date?t.coerce.date():t.date():r.dataType==="string"?i=Zd(r,t,s):r.dataType==="json"?i=Ud:r.dataType==="custom"?i=t.any():r.dataType==="buffer"&&(i=Qd)),i||(i=t.any()),i}function Wd(r,e,t){let s=r.getSQLType().includes("unsigned"),i,n,o=!1;Q(r,["MySqlTinyInt","SingleStoreTinyInt"])?(i=s?0:V.INT8_MIN,n=s?V.INT8_UNSIGNED_MAX:V.INT8_MAX,o=!0):Q(r,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=s?0:V.INT16_MIN,n=s?V.INT16_UNSIGNED_MAX:V.INT16_MAX,o=!0):Q(r,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=s?0:V.INT24_MIN,n=s?V.INT24_UNSIGNED_MAX:V.INT24_MAX,o=Q(r,["MySqlMediumInt","SingleStoreMediumInt"])):Q(r,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=s?0:V.INT32_MIN,n=s?V.INT32_UNSIGNED_MAX:V.INT32_MAX,o=!0):Q(r,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=s?0:V.INT48_MIN,n=s?V.INT48_UNSIGNED_MAX:V.INT48_MAX):Q(r,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(s=s||Q(r,["MySqlSerial","SingleStoreSerial"]),i=s?0:Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=!0):Q(r,["MySqlYear","SingleStoreYear"])?(i=1901,n=2155,o=!0):(i=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER);let a=t===!0||t?.number?e.coerce.number():e.number();return a=a.min(i).max(n),o?a.int():a}function Kd(r,e,t){let s=r.getSQLType().includes("unsigned"),i=s?0n:V.INT64_MIN,n=s?V.INT64_UNSIGNED_MAX:V.INT64_MAX;return(t===!0||t?.bigint?e.coerce.bigint():e.bigint()).min(i).max(n)}function Zd(r,e,t){if(Q(r,["PgUUID"]))return e.string().uuid();let s,i,n=!1;Q(r,["PgVarchar","SQLiteText"])?s=r.length:Q(r,["MySqlVarChar","SingleStoreVarChar"])?s=r.length??V.INT16_UNSIGNED_MAX:Q(r,["MySqlText","SingleStoreText"])&&(r.textType==="longtext"?s=V.INT32_UNSIGNED_MAX:r.textType==="mediumtext"?s=V.INT24_UNSIGNED_MAX:r.textType==="text"?s=V.INT16_UNSIGNED_MAX:s=V.INT8_UNSIGNED_MAX),Q(r,["PgChar","MySqlChar","SingleStoreChar"])&&(s=r.length,n=!0),Q(r,["PgBinaryVector"])&&(i=/^[01]+$/,s=r.dimensions);let o=t===!0||t?.string?e.coerce.string():e.string();return o=i?o.regex(i):o,s&&n?o.length(s):s?o.max(s):o}function Pc(r){return ii(r)?Hr(r):Mo(r)}function Oc(r,e,t,s){let i={};for(let[n,o]of Object.entries(r)){if(!m(o,q)&&!m(o,w)&&!m(o,w.Aliased)&&typeof o=="object"){let h=ii(o)||jo(o)?Pc(o):o;i[n]=Oc(h,e[n]??{},t,s);continue}let a=e[n];if(a!==void 0&&typeof a!="function"){i[n]=a;continue}let u=m(o,q)?o:void 0,l=u?kc(u,s):ae.any(),c=typeof a=="function"?a(l):l;t.never(u)||(i[n]=c,u&&(t.nullable(u)&&(i[n]=i[n].nullable()),t.optional(u)&&(i[n]=i[n].optional())))}return ae.object(i)}var Gd={never:r=>r?.generated?.type==="always"||r?.generatedIdentity?.type==="always",optional:r=>!r.notNull||r.notNull&&r.hasDefault,nullable:r=>!r.notNull};var po=(r,e)=>{let t=Pc(r);return Oc(t,e??{},Gd)};var le=Nn("issues",{id:_r("id").primaryKey(),title:de("title").notNull(),description:de("description").notNull(),status:de("status").notNull().default("OPEN"),priority:de("priority").notNull().default("MEDIUM"),assigneeId:de("assignee_id"),organizationId:de("organization_id").notNull(),createdAt:Lt("created_at").defaultNow(),updatedAt:Lt("updated_at").defaultNow()}),qs=Nn("activity_logs",{id:_r("id").primaryKey(),issueId:es("issue_id").references(()=>le.id).notNull(),action:de("action").notNull(),oldValue:de("old_value"),newValue:de("new_value"),actorId:de("actor_id").notNull(),organizationId:de("organization_id").notNull(),timestamp:Lt("timestamp").defaultNow()}),Jd=po(le).omit({id:!0,createdAt:!0,updatedAt:!0}),Hd=po(qs).omit({id:!0,timestamp:!0});Rs.neonConfig.webSocketConstructor=mc;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var Xd=new Rs.Pool({connectionString:process.env.DATABASE_URL}),Pt=ys({client:Xd,schema:go});var tr=class{async create(e,t){let{organizationId:s,userId:i}=t,[n]=await Pt.insert(le).values({...e,organizationId:s,status:"OPEN",priority:e.priority||"MEDIUM"}).returning();return await this.logActivity(n.id,"CREATE",null,"CREATED",t),n}async findAll(e){return Pt.select().from(le).where($e(le.organizationId,e)).orderBy(rs(le.createdAt))}async findOne(e,t){let[s]=await Pt.select().from(le).where(at($e(le.id,e),$e(le.organizationId,t)));if(!s)throw new Ms.NotFoundException(`Issue #${e} not found in this organization`);return s}async update(e,t,s){let i=await this.findOne(e,s.organizationId),[n]=await Pt.update(le).set({...t,updatedAt:new Date}).where($e(le.id,e)).returning();return t.status&&t.status!==i.status&&await this.logActivity(e,"UPDATE_STATUS",i.status,t.status,s),t.assigneeId&&t.assigneeId!==i.assigneeId&&await this.logActivity(e,"UPDATE_ASSIGNEE",i.assigneeId||"Unassigned",t.assigneeId,s),n}async remove(e,t){await this.findOne(e,t.organizationId),await Pt.delete(le).where($e(le.id,e))}async logActivity(e,t,s,i,n){await Pt.insert(qs).values({issueId:e,action:t,oldValue:s,newValue:i,actorId:n.userId,organizationId:n.organizationId})}};tr=te([(0,Ms.Injectable)()],tr);var rr=class{};rr=te([(0,Ac.Module)({controllers:[Ce],providers:[tr]})],rr);var Bs=require("@nestjs/common");var sr=class{use(e,t,s){let i=e.headers["x-organization-id"],n=e.headers["x-user-id"],o=e.headers["x-user-role"];if(!i)throw new Bs.BadRequestException("X-Organization-Id header is missing");e.user={organizationId:i,userId:n||"anonymous",role:o||"MEMBER"},s()}};sr=te([(0,Bs.Injectable)()],sr);var ir=class{configure(e){e.apply(sr).forRoutes({path:"*",method:Fs.RequestMethod.ALL})}};ir=te([(0,Fs.Module)({imports:[rr]})],ir);async function Yd(){let r=await $c.NestFactory.create(ir);r.useGlobalPipes(new Ic.ValidationPipe({transform:!0})),r.enableCors(),r.setGlobalPrefix("api"),await r.listen(5e3,"0.0.0.0"),console.log(`Application is running on: ${await r.getUrl()}`)}Yd();
